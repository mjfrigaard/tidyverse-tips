---
title: How to use ggplot2 themes
author: Martin Frigaard
date: '2021-01-10'
slug: how-to-use-ggplot2-themes
categories:
  - Rmarkdown
tags: []
---

```{r setup, include=FALSE}
library(knitr)
# base options ----
base::options(
  tibble.print_max = 25,
  tibble.width = 78,
  scipen = 100000000,
  max.print = 999999
)
# knitr chunk options ----
knitr::opts_chunk$set(
  echo = TRUE, # show/hide all code
  tidy = FALSE, # cleaner code printing
  comment = "#> ", # better console printing
  eval = FALSE, # turn this to FALSE stop code chunks from running
  message = TRUE, # show messages
  fig.width = 7, # figure width
  fig.height = 5, # figure height
  warning = FALSE# show warnings
) # location of files
# knitr knit settings ----
knitr::opts_knit$set(
  width = 78
)
```


This project will use the video game sales datasets from Kaggle found [here](https://www.kaggle.com/ashaheedq/video-games-sales-2019). Our objective with this project is to **visualize the relationship between game sales and their reviews in the top selling video games in from 2000-2019.**

**Quick Tip About R:** When writing code in R, A general rule of thumb is, ["*everything is an object.*"](https://www.oreilly.com/library/view/r-in-a/9781449358204/) However, it might surprise you how many things are considered *functions*. Take the following objects in R:

-   `+` perform basic arithmetic

-   `<-` create new objects

-   `==` make comparisons

-   `c()` combine arguments to create a vector (R's most common object)

-   `lm()` create linear models

Below we use `purrr` and `class()` to test and see if the objects above are functions or not, we need to enclose these objects in backticks ( \` ).

```{r test-function}
# are all these functions?
weird_stuff <- list(`+`, # unary plus operator
                    `<-`, # assignment operator
                    `==`, # binary operator
                    `lm`, # create a linear model 
                    `c`)  # concatenate elements into a vector
map(weird_stuff, class)
```

```{r test-function-out}
# [[1]]
# [1] "function"
# 
# [[2]]
# [1] "function"
# 
# [[3]]
# [1] "function"
# 
# [[4]]
# [1] "function"
# 
# [[5]]
# [1] "function"
```

Knowing what objects can be passed to the `.f` argument is helpful for understanding how we can use iteration to solve problems in R.

With the `VideoGames` data loaded into R, now we can take a look at it's structure and see what variables we have.

```{r VideoGames-glimpse}
VideoGames %>% dplyr::glimpse()
```

```{r VideoGames-glimpse-out}
# Rows: 55,792
# Columns: 23
# $ rank            <dbl> 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, …
# $ name            <chr> "Wii Sports", "Super Mario Bros.", "Mario Kart Wii"…
# $ basename        <chr> "wii-sports", "super-mario-bros", "mario-kart-wii",…
# $ genre           <chr> "Sports", "Platform", "Racing", "Shooter", "Sports"…
# $ esrb_rating     <chr> "E", NA, "E", NA, "E", "E", "E", "E", "E", NA, NA, …
# $ platform        <chr> "Wii", "NES", "Wii", "PC", "Wii", "GB", "DS", "GB",…
# $ publisher       <chr> "Nintendo", "Nintendo", "Nintendo", "PUBG Corporati…
# $ developer       <chr> "Nintendo EAD", "Nintendo EAD", "Nintendo EAD", "PU…
# $ vg_chartz_score <lgl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
# $ critic_score    <dbl> 7.7, 10.0, 8.2, NA, 8.0, 9.4, 9.1, NA, 8.6, 10.0, N…
# $ user_score      <dbl> NA, NA, 9.1, NA, 8.8, NA, 8.1, NA, 9.2, NA, NA, 4.5…
# $ total_shipped   <dbl> 82.86, 40.24, 37.14, 36.60, 33.09, 31.38, 30.80, 30…
# $ global_sales    <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
# $ na_sales        <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
# $ pal_sales       <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
# $ jp_sales        <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
# $ other_sales     <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
# $ year            <dbl> 2006, 1985, 2008, 2017, 2009, 1998, 2006, 1989, 200…
# $ last_update     <chr> NA, NA, "11th Apr 18", "13th Nov 18", NA, NA, NA, N…
# $ url             <chr> "http://www.vgchartz.com/game/2667/wii-sports/?regi…
# $ status          <dbl> 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, …
# $ vgchartzscore   <dbl> NA, NA, 8.7, NA, 8.8, NA, NA, NA, 9.1, NA, NA, 5.3,…
# $ img_url         <chr> "/games/boxart/full_2258645AmericaFrontccc.jpg", "/…
```

## Wrangle

In order to visualize the relationship between sales and reviewer scores, we need to `pivot_` the data in `VideoGames` to a `long` format using `tidyr`. We can see there are two `_score` variables and five `_sales` variables. Let's tidy these into `score` and `score_value` and `sales` and `sales_value`.

```{r TidyVGSales-score-pivot_longer, eval=TRUE, results='hide'}
# tidy scores 
TidyVGScores <- VideoGames %>% 
  tidyr::pivot_longer(names_to = "score_type", values_to = "score_value", 
                      cols = c(critic_score, user_score))
# tidy sales 
TidyVGSales <- TidyVGScores %>% 
    tidyr::pivot_longer(names_to = "sales_type", values_to = "sales_value", 
                      cols = c(global_sales, na_sales, pal_sales, jp_sales, 
                               other_sales))
# Remove the intermediate dataset so we don't use up too much memory
rm(TidyVGScores)
# view
TidyVGSales %>% glimpse()
```

```{r view-TidyVGSales}
# Rows: 557,920
# Columns: 20
# $ rank            <dbl> 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, …
# $ name            <chr> "Wii Sports", "Wii Sports", "Wii Sports", "Wii Spor…
# $ basename        <chr> "wii-sports", "wii-sports", "wii-sports", "wii-spor…
# $ genre           <chr> "Sports", "Sports", "Sports", "Sports", "Sports", "…
# $ esrb_rating     <chr> "E", "E", "E", "E", "E", "E", "E", "E", "E", "E", N…
# $ platform        <chr> "Wii", "Wii", "Wii", "Wii", "Wii", "Wii", "Wii", "W…
# $ publisher       <chr> "Nintendo", "Nintendo", "Nintendo", "Nintendo", "Ni…
# $ developer       <chr> "Nintendo EAD", "Nintendo EAD", "Nintendo EAD", "Ni…
# $ vg_chartz_score <lgl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
# $ total_shipped   <dbl> 82.86, 82.86, 82.86, 82.86, 82.86, 82.86, 82.86, 82…
# $ year            <dbl> 2006, 2006, 2006, 2006, 2006, 2006, 2006, 2006, 200…
# $ last_update     <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
# $ url             <chr> "http://www.vgchartz.com/game/2667/wii-sports/?regi…
# $ status          <dbl> 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, …
# $ vgchartzscore   <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
# $ img_url         <chr> "/games/boxart/full_2258645AmericaFrontccc.jpg", "/…
# $ score_type      <chr> "critic_score", "critic_score", "critic_score", "cr…
# $ score_value     <dbl> 7.7, 7.7, 7.7, 7.7, 7.7, NA, NA, NA, NA, NA, 10.0, …
# $ sales_type      <chr> "global_sales", "na_sales", "pal_sales", "jp_sales"…
# $ sales_value     <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
```

Just as a reminder, our objective is to **visualize the relationship between game sales and their reviews in the top selling video games in from 2010-2019.** We will `filter` the data to only the `year`s between `2010` and `2019` below.

```{r TidyVidGam00_19, eval=TRUE}
TidyVidGam00_19 <- TidyVGSales %>% filter(year >= 2010 & year <= 2019)
```

We should see only 10 `year`s listed, from `2010` to `2019`.

```{r count-year}
TidyVidGam00_19 %>% dplyr::count(year)
```

```{r count-year-out, echo=FALSE, eval=TRUE}
TidyVidGam00_19 %>% dplyr::count(year) %>% rmarkdown::paged_table()
```

## Visualize

We are going to set the theme for our plots with [`tvthemes::theme_rickAndMorty()`](https://github.com/Ryo-N7/tvthemes).

```{r theme_set, eval=TRUE, warning=FALSE, message=FALSE}
library(tvthemes)
library(scales)
library(glue)
library(png)
library(extrafont)
loadfonts(quiet = TRUE)
ggplot2::theme_set(tvthemes::theme_spongeBob(title.font = "Roboto Condensed",
                  text.font = "Roboto Condensed",
                  title.size = 13,
                  subtitle.size = 11,
                  text.size = 12,
                  legend.position = "none"))
```

Let's take a look at the two variables we want in our visualization: scores and sales. First we can check the missing values in the two variables with `inspect_na()` from the `inspectdf` package.

```{r inspect_na, eval=TRUE, message=FALSE}
TidyVidGam00_19 %>% 
  select(ends_with("_value")) %>% inspectdf::inspect_na() %>% 
  inspectdf::show_plot(text_labels = TRUE) + 
  tvthemes::scale_fill_bigHero6() 
```

This tells us there are quite a few missing values, so We will drop these and see what the relationship looks between for `score_value` vs. `sales_value` for all ten years.

```{r total-scores-total-sales, eval=TRUE}
TidyVidGam00_19 %>% 
  # select variables of interest
  dplyr::select(ends_with("_type"), ends_with("_value")) %>% 
  # remove missing
  tidyr::drop_na() %>% 
  # base aesthetics
  ggplot2::ggplot(aes(x=score_value, y=sales_value)) + 
  geom_point() + 
  tvthemes::scale_fill_bigHero6() +
  # labels for every plot so I know what I should see
  ggplot2::labs(title="Review scores vs. sales for video games", subtitle="from 2010-2019",
                caption="https://www.kaggle.com/ashaheedq/video-games-sales-2019", x="Total sales", y="Total score") 
```

This looks like there might be a general trend, but we will need to use additional aesthetics to explore the nuances between `score_type`, `sales_type`, and `year`.

```{r facet-year-user, eval=TRUE}
TidyVidGam00_19 %>% 
  # add filter for user reviews 
  dplyr::filter(score_type == "user_score") %>%
  # select variables of interest
  select(year, ends_with("_type"), ends_with("_value")) %>% 
  # remove missing
  tidyr::drop_na() %>% 
  # base aesthetics
  ggplot2::ggplot(aes(x=score_value, y=sales_value, group=year)) + 
  geom_point() + 
  tvthemes::scale_fill_bigHero6() +
  # facet by year
  facet_wrap(. ~ year, nrow=2) + 
  # labels to keep track 
  ggplot2::labs(title="User review scores vs. video game sales by year", subtitle="from 2010-2019", 
                caption="https://www.kaggle.com/ashaheedq/video-games-sales-2019", x="Total sales", y="User score") 
```

This shows us there aren't many data points for the user reviews (especially not in 2019). We will filter only the critic scores and see what trends we find.

```{r facet-year-critic, eval=TRUE}
TidyVidGam00_19 %>% 
  # add filter for critic reviews 
  dplyr::filter(score_type == "critic_score") %>%
  # select variables of interest
  select(year, ends_with("_type"), ends_with("_value")) %>% 
  # remove missing
  tidyr::drop_na() %>% 
  # base aesthetics
  ggplot2::ggplot(aes(x=score_value, y=sales_value, group=year)) + 
  geom_point() + 
  tvthemes::scale_fill_bigHero6() +
  # facet by year
  facet_wrap(. ~ year, nrow=2) + 
  # labels to keep track of what I should see
  ggplot2::labs(title="Critic review scores vs. video game sales by year", subtitle="from 2010-2019",
                caption="https://www.kaggle.com/ashaheedq/video-games-sales-2019", x="Total sales", y="Critic score") 
```

This shows more data points, but only one in 2019, so we will drop this year. 


I wonder how critic scores vary if we color them by `sales_type`? Let's adjust our theme and add color with faceting to view the differences.

```{r adjust-theme, eval=TRUE}
ggplot2::theme_set(theme_minimal() +
  theme(text = element_text(family = "Ubuntu"),
        plot.title = element_text(size = 13),
        plot.subtitle = element_text(size = 12),
        plot.caption = element_text(size = 10)))
```


```{r facet-sales_type-critic, eval=TRUE}
TidyVidGam00_19 %>% 
  # add filter for year 
  dplyr::filter(year != 2019 & score_type == "critic_score") %>% 
  # select variables of interest
  select(ends_with("_type"), ends_with("_value")) %>% 
  # remove missing
  tidyr::drop_na() %>% 
  # base aesthetics
  ggplot2::ggplot(aes(x=score_value, y=sales_value, group=sales_type)) + 
  # factor sales type for cleaner plotting and lighten opacity
  geom_point(aes(color=as.factor(sales_type)), alpha=1/3, show.legend=FALSE) +
  tvthemes::scale_fill_bigHero6() +
  facet_wrap(. ~ sales_type) + 
  # labels to keep track of what I should see
  labs(title="Critic review scores vs. video game sales by sales type", subtitle="from 2010-2019", 
       caption="https://www.kaggle.com/ashaheedq/video-games-sales-2019", x="Sales", y="Critic score")  
```

Hmmmm. Here we can see higher critic scores if the sales are from `global_sales`, `na_sales`, or `pal_sales`. Do you think this trend changes over time?

```{r facet-year-critic_score-sales_type, eval=TRUE}
TidyVidGam00_19 %>% 
  # add filter statement for sales types
  dplyr::filter(year != 2019 & score_type == "critic_score" & sales_type %in% c("global_sales", "na_sales", "pal_sales")) %>% 
  # select variables of interest
  select(year, ends_with("_type"), ends_with("_value")) %>% 
  # remove missing
  tidyr::drop_na() %>% 
  # add base aesthetics
  ggplot2::ggplot(aes(x=score_value, y=sales_value, color=sales_type, group=year)) + 
  # factor sales type for cleaner plotting
  geom_point(aes(color=as.factor(sales_type)), size=0.5, 
             # lighten opacity and descrease size
             alpha=1/3, show.legend=FALSE) + 
  # add smoothing line to see if there is a linear relationship
  geom_smooth(aes(group=sales_type), method="lm", se=FALSE) +
  tvthemes::scale_fill_bigHero6() +
  # facet by year
  facet_wrap(. ~ year) + 
  # adjust labels
  labs(title="Critic review scores vs. video game sales by sales type", subtitle="Best fit linear relationship between 2010-2019",
       caption="https://www.kaggle.com/ashaheedq/video-games-sales-2019", x="Sales", y="Critic score") 
```

We can see a possible linear relationship for `global_sales` in `2014` and maybe some interactions in other years. As you can see, my code is a mess! I have code extending way past the 80 column mark, and I have no spaces around all of my equal operators (`=`). 

RStudio is letting me know in the left-hand side of the screen next to the line numbers.

![](/post/2020-08-28-how-to-style-your-code_files/code-help.png){width=100% height=100%}