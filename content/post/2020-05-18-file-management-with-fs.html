---
title: How to manage your files with fs
author: Martin Frigaard
date: '2020-05-29'
slug: file-management-with-fs
categories: ["Workflow"]
tags: ["Workflow"]
---

<script src="/rmarkdown-libs/header-attrs/header-attrs.js"></script>


<p>Organizing your data, code, documents, and figures in a consistent way that’s easy to navigate is one of the most thoughtful and generous things you’ll ever do. It’s also a basic requirement for a reproducible data science project. In RStudio, this process is made easier with <code>.Rproj</code> files (<a href="https://www.tidyverse.org/blog/2017/12/workflow-vs-script/">read more</a>) and the <a href="https://github.com/jennybc/here_here"><code>here</code> package</a>.</p>
<div id="what-fs-does" class="section level2">
<h2>What <code>fs</code> does?</h2>
<p>The <a href="https://cran.r-project.org/web/packages/fs/readme/README.html"><code>fs</code> package</a> adds another layer of project organization by giving us access to a “<em>uniform interface to file system operations.</em>” Many of the <code>fs</code> functions aren’t new, but they now have consistent names (<code>path_</code>, <code>file_</code>, <code>dir_</code>, and <code>link_</code>) and return tidy paths (using <code>/</code> and not <code>//</code> or trailing <code>/</code>). Windows users have likely experienced the bane of collaborating with Unix users (and vice versa) because of the <a href="https://www.howtogeek.com/181774/why-windows-uses-backslashes-and-everything-else-uses-forward-slashes/">difference in file paths</a>.</p>
</div>
<div id="how-fs-works" class="section level2">
<h2>How <code>fs</code> works</h2>
<p>We will be using <a href="https://github.com/hadley/nycflights13">Hadley Wickham’s <code>nycflights13</code> package</a> as an example project to demonstrate some of the features of <code>fs</code>. First we’ll get a ‘big picture’ view of the project folder and it’s contents using <code>fs::dir_tree()</code>:</p>
<pre class="r"><code>fs::dir_tree(&quot;nycflights13&quot;)
## nycflights13
## ├── DESCRIPTION
## ├── NAMESPACE
## ├── NEWS.md
## ├── R
## │   ├── airlines.R
## │   ├── airport.R
## │   ├── flights.R
## │   ├── planes.R
## │   └── weather.R
## ├── README.md
## ├── cran-comments.md
## ├── data
## │   ├── airlines.rda
## │   ├── airports.rda
## │   ├── flights.rda
## │   ├── planes.rda
## │   └── weather.rda
## ├── data-raw
## │   ├── airlines.R
## │   ├── airlines.csv
## │   ├── airports.R
## │   ├── airports.csv
## │   ├── airports.dat
## │   ├── airports.svg
## │   ├── flights.R
## │   ├── planes.R
## │   ├── planes.csv
## │   ├── weather.R
## │   └── weather.csv
## ├── man
## │   ├── airlines.Rd
## │   ├── airports.Rd
## │   ├── flights.Rd
## │   ├── planes.Rd
## │   └── weather.Rd
## ├── nycflights.Rproj
## └── revdep
##     ├── README.md
##     ├── email.yml
##     └── problems.md</code></pre>
<p><code>dir_tree()</code> is similar to the <a href="https://www.geeksforgeeks.org/tree-command-unixlinux/"><code>tree</code> command in Linux</a>. If we want to narrow the scope of the tree, we can specify a subfolder and use the <code>regexp</code> or <code>glob</code> arguments.</p>
<pre class="r"><code>fs::dir_tree(path = &quot;nycflights13/data-raw&quot;, regexp = &quot;[.]csv$&quot;)
## nycflights13/data-raw
## ├── airlines.csv
## ├── airports.csv
## ├── planes.csv
## └── weather.csv</code></pre>
<p><code>fs</code> does more than just print folder contents to the screen. We can also construct clean file paths with <code>fs::path()</code></p>
<pre class="r"><code># create path to raw data 
raw_data_path &lt;- fs::path(&quot;nycflights13&quot;, &quot;data-raw&quot;)
# view these files in the OS
fs::file_show(raw_data_path)</code></pre>
<p><img src="/post/2020-05-18-file-management-with-fs_files/file_show.png" style="width:80.0%" /></p>
</div>
<div id="creating-folders-and-files-with-less-worry" class="section level2">
<h2>Creating folders and files (with less worry)</h2>
<p>I have a tendency to create <code>data</code> and <code>code</code> folders frequently. The <code>fs::dir_create()</code> and <code>fs::file_create()</code> functions are great because they don’t overwrite my existing folders or files (no need for <code>if(!file.exists("data))</code> statements anymore!).</p>
<pre class="r"><code># assume I already have a data-csv folder and data-csv/README.md file
fs::dir_tree(&quot;data-csv&quot;)
# what is in this file?
base::system(command = &quot;cat &#39;data-csv/README.md&#39;&quot;)</code></pre>
<pre class="r"><code># data-csv
# └── README.md
# CSV Data Files
# ==============
# 
# PLEASE!!! ‹(•_•)› NEVER CHANGE ME! ––•––√\/––√\/––•––•––√\/––√\/––•––•</code></pre>
<p>Obviously some files should not be overwritten or altered after they’ve been created.</p>
<pre class="r"><code># will we overwrite this? try to create new data folder
fs::dir_create(&quot;data-csv&quot;)
# and try to create new README.md file
fs::file_create(&quot;data-csv/README.md&quot;)
# check their contents 
base::system(command = &quot;cat &#39;data-csv/README.md&#39;&quot;)</code></pre>
<pre class="r"><code># CSV Data Files
# ==============
# 
# PLEASE!!! ‹(•_•)› NEVER CHANGE ME! ––•––√\/––√\/––•––•––√\/––√\/––•––•</code></pre>
<p>Well that’s good news.</p>
<div id="directoryfile-info-in-tibbles" class="section level3">
<h3>Directory/file info in tibbles!</h3>
<p>The best part of <code>fs</code> is that we can store all this meta data from a project repo and manipulate it just like any <code>tibble</code> in <code>tidyverse</code>!</p>
<pre class="r"><code># store directory inforamtion in NycF13DirInfo
NycF13DirInfo &lt;- fs::dir_info(&quot;nycflights13&quot;, recurse = TRUE)
NycF13DirInfo %&gt;% 
  # check the files only
  dplyr::filter(type == &quot;file&quot;) %&gt;% 
  # that are biggest 
  dplyr::arrange(desc(size)) %&gt;% 
  # only view size, birth time, and change time
  dplyr::select(path, size, birth_time, change_time) %&gt;% 
  # return top 5
  utils::head(5)
##                                 path    size          birth_time
## 1      nycflights13/data/flights.rda    4.1M 2019-09-16 10:29:09
## 2  nycflights13/data-raw/weather.csv   2.19M 2019-09-16 10:29:09
## 3 nycflights13/data-raw/airports.dat 830.38K 2019-09-16 10:29:09
## 4   nycflights13/data-raw/planes.csv  241.4K 2019-09-16 10:29:09
## 5 nycflights13/data-raw/airports.svg 226.37K 2019-09-16 10:29:09
##           change_time
## 1 2020-05-29 11:37:44
## 2 2020-05-29 11:37:44
## 3 2020-05-29 11:37:44
## 4 2020-05-29 11:37:44
## 5 2020-05-29 11:37:44</code></pre>
<p>This can come in handy if you’re looking for the last time you modified a file, or if you’re looking for a particularly large/small file.</p>
</div>
</div>
<div id="moving-and-copying-files" class="section level2">
<h2>Moving and copying files</h2>
<p>We can also easily copy files from one location to another. Below we move all the <code>.csv</code> files from <code>data-raw</code> into the parent <code>data</code> folder.</p>
<pre class="r"><code>NycF13DirInfo %&gt;% 
  # find all .csv files 
  dplyr::filter(stringr::str_detect(string = path, pattern = &quot;.csv&quot;)) %&gt;% 
  # move them into the parent data/ folder
  fs::file_copy(path = .$path, new_path =  fs::path(&quot;data-csv&quot;))
# sanity check
fs::dir_tree(&quot;data-csv&quot;)
## data-csv
## ├── README.md
## ├── airlines.csv
## ├── airports.csv
## ├── planes.csv
## └── weather.csv</code></pre>
<p>What if we’d like to read all of these files into one big data frame? We can create an <code>fs_path</code> which is a named character vector (with some additional coloring on capable terminals).</p>
<pre class="r"><code># csv files
csv_files &lt;- fs::dir_ls(path = &quot;data-csv&quot;, glob = &quot;*.csv&quot;)
utils::str(csv_files)
##  &#39;fs_path&#39; Named chr [1:4] &quot;data-csv/airlines.csv&quot; &quot;data-csv/airports.csv&quot; ...
##  - attr(*, &quot;names&quot;)= chr [1:4] &quot;data-csv/airlines.csv&quot; &quot;data-csv/airports.csv&quot; &quot;data-csv/planes.csv&quot; &quot;data-csv/weather.csv&quot;
base::class(csv_files)
## [1] &quot;fs_path&quot;   &quot;character&quot;
base::is.character(csv_files)
## [1] TRUE</code></pre>
<p>We can now pass this to <code>purrr::map_df()</code> and get all the .csv files in a huge dataset.</p>
<pre class="r"><code>AllNycFlights &lt;- csv_files %&gt;%
  purrr::map_df(.f = read_csv, .id = &quot;file&quot;, col_types = cols()) 
AllNycFlights %&gt;% glimpse()
## Rows: 30,911
## Columns: 33
## $ file         &lt;chr&gt; &quot;data-csv/airlines.csv&quot;, &quot;data-csv/airlines.csv&quot;, &quot;data-…
## $ carrier      &lt;chr&gt; &quot;9E&quot;, &quot;AA&quot;, &quot;AS&quot;, &quot;B6&quot;, &quot;DL&quot;, &quot;EV&quot;, &quot;F9&quot;, &quot;FL&quot;, &quot;HA&quot;, &quot;M…
## $ name         &lt;chr&gt; &quot;Endeavor Air Inc.&quot;, &quot;American Airlines Inc.&quot;, &quot;Alaska A…
## $ faa          &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …
## $ lat          &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …
## $ lon          &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …
## $ alt          &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …
## $ tz           &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …
## $ dst          &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …
## $ tzone        &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …
## $ tailnum      &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …
## $ year         &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …
## $ type         &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …
## $ manufacturer &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …
## $ model        &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …
## $ engines      &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …
## $ seats        &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …
## $ speed        &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …
## $ engine       &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …
## $ origin       &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …
## $ month        &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …
## $ day          &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …
## $ hour         &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …
## $ temp         &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …
## $ dewp         &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …
## $ humid        &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …
## $ wind_dir     &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …
## $ wind_speed   &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …
## $ wind_gust    &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …
## $ precip       &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …
## $ pressure     &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …
## $ visib        &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …
## $ time_hour    &lt;dttm&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…</code></pre>
<p>Yikes! Crazy huh? Well, this isn’t very practical to work with, but we could use <code>dplyr::filter()</code> to get the datasets we needed.</p>
<p>The different values for <code>file</code> should correspond to the number of observations in each dataset in the <code>nycflights13</code> package.</p>
<pre class="r"><code># are these the number of observations per dataset?
AllNycFlights %&gt;% dplyr::count(file, sort = TRUE)
## # A tibble: 4 x 2
##   file                      n
##   &lt;chr&gt;                 &lt;int&gt;
## 1 data-csv/weather.csv  26115
## 2 data-csv/planes.csv    3322
## 3 data-csv/airports.csv  1458
## 4 data-csv/airlines.csv    16
# sanity check 
nycflights13::weather %&gt;% base::nrow()
## [1] 26115
# yes</code></pre>
</div>
<div id="works-well-with-purrr-package" class="section level2">
<h2>Works well with <code>purrr</code> package!</h2>
<p>Ok, let’s time-stamp these files and export them into a <code>today-csv</code> folder fun!</p>
<pre class="r"><code># create today-csv folder
fs::dir_create(&quot;today-csv&quot;)
# create path
today_csv_path &lt;- fs::path(&quot;today-csv/&quot;, base::noquote(lubridate::today()), &quot;/&quot;)
# remove previous path from file
AllNycFlights %&gt;%
  dplyr::mutate(file = stringr::str_remove_all(string = file, 
                                               pattern = &quot;data-csv/&quot;)) %&gt;% 
  # group by file
  dplyr::group_by(file) %&gt;% 
  # keep only distinct rows (probably redundant)
  dplyr::group_map(~ dplyr::distinct(.x, .keep_all=TRUE), keep = TRUE) %&gt;%
  purrr::walk(~.x %&gt;% 
                 readr::write_csv(path = paste0(today_csv_path, 
                                         &quot;_&quot;,
                                         unique(.x$file))))
# sanity check!
fs::dir_tree(&quot;today-csv&quot;)
## today-csv
## ├── 2020-05-29_airlines.csv
## ├── 2020-05-29_airports.csv
## ├── 2020-05-29_planes.csv
## └── 2020-05-29_weather.csv</code></pre>
<p>Check out the vignette and package site for more information!</p>
</div>
