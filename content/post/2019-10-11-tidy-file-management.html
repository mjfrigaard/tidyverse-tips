---
title: tidy file management
author: Martin Frigaard
date: '2019-10-11'
slug: tidy-file-management
categories:
  - tidyverse
tags:
  - rstats
description: Knowing where your files are is essential to being productive. This post covers tools for managing files in a tidy way.
---



<blockquote>
<p>“<em>The organization of information actually creates new information.</em>” - Richard Saul Wurman</p>
</blockquote>
<p>Keeping files organized is an essential part of any data project, and if you’re just starting a career in data science, it’s important to build good habits early. There are plenty of general resources on the internet for setting up a data science project. I like these:</p>
<ul>
<li><p><a href="https://swcarpentry.github.io/good-enough-practices-in-scientific-computing/">Good Enough Practices for Scientific Computing</a></p></li>
<li><p><a href="https://journals.plos.org/plosbiology/article?id=10.1371/journal.pbio.1001745">Best Practices for Scientific Computing</a></p></li>
<li><p><a href="https://drivendata.github.io/cookiecutter-data-science/">Cookiecutter Data Science</a></p></li>
</ul>
<p>In this post I’ll cover <a href="https://fs.r-lib.org/"><code>fs</code></a>, a package with tools for tidy file management.</p>
<div id="using-the-fs-package" class="section level2">
<h2>Using the <code>fs</code> package</h2>
<p>The <a href="https://fs.r-lib.org/"><code>fs</code> package</a> was somewhat inspired by <a href="https://en.wikipedia.org/wiki/Rust_(programming_language)">Rust</a>‘s <a href="https://doc.rust-lang.org/std/fs/index.html">fs module</a>. The <code>fs</code> stands for ’file system.’</p>
<div id="so-you-have-a-new-project" class="section level3">
<h3>So you have a new project</h3>
<p>Assume you have a data project you’ve downloaded from Github like this one from <a href="https://github.com/plotly/datasets">Plotly</a>.</p>
<p><img src="/post/2019-10-11-tidy-file-management_files/plotly-data-project.jpg" style="width:70.0%;height:70.0%" /></p>
<p>Download this repository into your RStudio session using the following commands in the Terminal or in a bash code chunk.</p>
<pre class="sh"><code>git clone https://github.com/plotly/datasets.git</code></pre>
<p>Now that we have a new folder full of data files, we want to know some basics about the folder contents. The <code>fs</code> package allows us to view the contents of a project in a hierarchical display. This is accomplished using the <code>fs::dir_tree()</code> function.</p>
<pre class="r"><code>fs::dir_tree(path = &quot;.&quot;)</code></pre>
<pre class="r"><code>├── README.Rmd
├── datasets
│   ├── 1962_2006_walmart_store_openings.csv
│   ├── 2010_alcohol_consumption_by_country.csv
│   ├── 2011_february_aa_flight_paths.csv
│   ├── 2011_february_us_airport_traffic.csv
│   ├── 2011_us_ag_exports.csv
│   ├── 2014_apple_stock.csv
│   ├── 2014_ebola.csv
│   ├── 2014_us_cities.csv
│   ├── 2014_usa_states.csv
│   ├── 2014_world_gdp_with_codes.csv
│   ├── 2015_06_30_precipitation.csv
│   ├── 2015_Instant_Noodle_Consumption_Around_the_World.csv
│   ├── 2016-weather-data-seattle.csv
│   ├── 26k-consumer-complaints.csv
│   ├── 3d-line1.csv
│   ├── 3d-mesh-helicopter.csv
│   ├── 3d-ribbon.json
│   ├── 3d-scatter.csv
│   ├── Aids Data.csv
│   ├── Antibiotics.csv
│   ├── BulletData.json
│   ├── Canada Immigration.csv
│   ├── Consumer Complaints.csv
│   ├── Emissions Data.csv
│   ├── GanttChart-updated.csv
│   ├── GanttChart.csv
│   ├── Key Macroeconomic Indicators.csv
│   ├── LICENSE
│   ├── Mining-BTC-180.csv
│   ├── Monitory Policy Transmission.csv
│   ├── Move to Canada.csv
│   ├── Nominal and Real Fed Funds Rate.csv
│   ├── Nuclear Waste Sites on American Campuses.csv
│   ├── PK_subban_shots.json
│   ├── README.md
│   ├── _3d-line-plot.csv
│   ├── alpha_shape.csv
│   ├── api_docs
│   │   ├── 3d_line_sample_data.csv
│   │   ├── README.md
│   │   ├── method_of_steepest_descent_contour.csv
│   │   └── mt_bruno_elevation.csv
│   ├── auto-mpg.csv
│   ├── bar-charts-with-excel.csv
│   ├── beers.csv
│   ├── bubble_chart_tutorial.csv
│   ├── candlestick_dataset_2007_2009.csv
│   ├── carshare.csv
│   ├── clebsch-cubic.csv
│   ├── clustergram_GDS5373.soft
│   ├── coffee-flavors.csv
│   ├── contour_data.json
│   ├── cost_output_defective.csv
│   ├── custom_heatmap_colorscale.json
│   ├── dash-stock-ticker-demo.csv
│   ├── data-matlab-excel-example.xlsx
│   ├── data.csv
│   ├── data.csv.zip
│   ├── data_dictionary.csv
│   ├── diabetes.csv
│   ├── district_density.csv
│   ├── dot-plot-with-excel.csv
│   ├── earthquake.csv
│   ├── earthquakes-23k.csv
│   ├── english_french.csv
│   ├── european_leaders.csv
│   ├── european_turnout.csv
│   ├── finance-charts-apple.csv
│   ├── fips-unemp-16.csv
│   ├── flightdata.csv
│   ├── florida-blue-data.json
│   ├── florida-red-data.json
│   ├── florida_county_data.geojson
│   ├── gantt_example.csv
│   ├── gapminder2007.csv
│   ├── gapminderDataFiveYear.csv
│   ├── gapminderDataFiveYear2.csv
│   ├── gapminderData_Americas_2007.csv
│   ├── gapminder_unfiltered.csv
│   ├── gapminder_with_codes.csv
│   ├── geojson-counties-fips.json
│   ├── globe_contours.csv
│   ├── hello-world-stock.csv
│   ├── histogram_simple.csv
│   ├── hobbs-pearson-trials.csv
│   ├── imports-85.csv
│   ├── inset.csv
│   ├── iris-data.csv
│   ├── iris-id.csv
│   ├── iris.csv
│   ├── job-automation-probability.csv
│   ├── label-text.csv
│   ├── latex-typesetting-with-excel.csv
│   ├── laucnty16.csv
│   ├── line_3d_dataset.csv
│   ├── medicare.csv
│   ├── medicare_cost.csv
│   ├── mesh_dataset.txt
│   ├── minoritymajority.csv
│   ├── miserables.json
│   ├── monthly-milk-production-pounds.csv
│   ├── motor_trend_car_road_tests.csv
│   ├── mpg.csv
│   ├── mpg_2017.txt
│   ├── mtcars.csv
│   ├── mtl2013ternary.csv
│   ├── multiple_y_axis.csv
│   ├── nhl_draft_2013_@thejustinfisher.csv
│   ├── normal-clusters.csv
│   ├── nz_weather.csv
│   ├── okcupid-compatibility-by-religion.csv
│   ├── parcoords_data.csv
│   ├── pareto-chart.csv
│   ├── pie-charts-with-excel.csv
│   ├── polar_dataset.csv
│   ├── polar_scatter_chart.json
│   ├── processed_data.csv
│   ├── recessions.csv
│   ├── scatter_data.json
│   ├── school_earnings.csv
│   ├── segment-funnel-dataset.csv
│   ├── shaded-region.csv
│   ├── solar.csv
│   ├── spectral.csv
│   ├── spinrates.csv
│   ├── steepest.json
│   ├── stockdata.csv
│   ├── stockdata2.csv
│   ├── streamtube-basic.csv
│   ├── streamtube-wind.csv
│   ├── styled-line.csv
│   ├── subplot.csv
│   ├── subplots.csv
│   ├── sunburst-coffee-flavors-complete.csv
│   ├── tesla-stock-price.csv
│   ├── time-series-with-error-bars-excel.csv
│   ├── timeseries.csv
│   ├── tips.csv
│   ├── titanic-mosaic-chart.csv
│   ├── titanic.csv
│   ├── tooth_growth_csv
│   ├── uber-rides-data1.csv
│   ├── uber-rides-data2.csv
│   ├── uber-rides-data3.csv
│   ├── us-cities-top-1k.csv
│   ├── violin_data.csv
│   ├── volcano.csv
│   ├── volcano_db.csv
│   ├── vortex.csv
│   ├── wage rigidity dataset.csv
│   ├── wind_rose.csv
│   ├── wind_speed_laurel_nebraska.csv
│   └── windrose_tidy.csv
├── figs
└── plotly-data.Rproj</code></pre>
<p>As we can see, this displays the entire folder contents in a tree structure layout, similar to the <a href="https://michaelsoolee.com/tree-tool/">tree command line tool</a>. The tree shows us the data are stored in the <code>datasets</code> folder.</p>
<p>As you’re working on a data project, you might want to organize the files in a way that works well for you. As Doug Merrill, the former chief information officer and VP of engineering at Google, says <a href="https://www.amazon.com/Organized-Mind-Thinking-Straight-Information/dp/0147516315">“organization isn’t—nor should it be—the same for everybody”</a>. If we look at the folder tree above, we can see there are six gapminder data sets. Let’s create a new <code>gapminder</code> folder and put all the Gapminder data inside of it.</p>
</div>
</div>
<div id="create-file-paths" class="section level2">
<h2>Create file paths</h2>
<p><a href="https://stackoverflow.com/questions/8425409/file-path-issues-in-r-using-windows-hex-digits-in-character-string-error">File paths can be a problem in R</a> depending on what operating system you use. Windows uses a backslash (<code>\</code>) and everyone else uses forward slashes (<code>/</code>). The difference can be a problem when projects get passed from one person to another, because code is written expecting certain files to be in certain places. The <code>fs</code> package makes the file paths tidy in two ways:</p>
<ol style="list-style-type: decimal">
<li>Always use <code>/</code> to delimit directories<br />
</li>
<li>Never have multiple <code>/</code> or trailing <code>/</code></li>
</ol>
<p>The <code>fs::path()</code> function creates clean and tidy paths.</p>
<pre class="r"><code>fs::path(&quot;path&quot;, &quot;to&quot;, &quot;my&quot;, &quot;data&quot;, &quot;files&quot;)</code></pre>
<pre class="r"><code>path/to/my/data/files</code></pre>
<p>We’ll use the <code>fs::dir_ls()</code> function to list the files in the <code>datasets</code> folder (<code>path = "datasets"</code>) with a regular expression (<code>regexp = "gapminder"</code>).</p>
<pre class="r"><code>gap_files &lt;- fs::dir_ls(path = &quot;datasets&quot;, 
                        regexp = &quot;gapminder&quot;)
gap_files</code></pre>
<pre class="r"><code>datasets/gapminder2007.csv
datasets/gapminderDataFiveYear.csv
datasets/gapminderDataFiveYear2.csv
datasets/gapminderData_Americas_2007.csv
datasets/gapminder_unfiltered.csv
datasets/gapminder_with_codes.csv</code></pre>
<p>The <code>gap_files</code></p>
</div>
<div id="create-new-folder" class="section level2">
<h2>Create new folder</h2>
<p>The new folder path for these gapminder data will be <code>datasets/gapminder</code>. We’ll use the <code>fs::path()</code> function to create a new file path.</p>
<pre class="r"><code>gap_path &lt;- fs::path(&quot;datasets&quot;, &quot;gapminder&quot;)
gap_path</code></pre>
<pre class="r"><code>datasets/gapminder</code></pre>
</div>
<div id="create-folder" class="section level2">
<h2>Create folder</h2>
<p>To create the new folder, we’ll use the <code>fs::dir_create()</code> to create the new folder using our new <code>gap_path</code> object.</p>
<pre class="r"><code>fs::dir_create(path = gap_path)</code></pre>
</div>
<div id="moving-files" class="section level2">
<h2>Moving files</h2>
<p>Both the <code>gap_path</code> and <code>gap_files</code> are “tidy file paths”, and together can use these objects to move the gapminder files into the <code>gapminder</code> folder with the <code>fs::file_move()</code> function. This function takes two arguments, <code>path</code> and <code>new_path</code>. <code>path</code> is where they are, <code>new_path</code> is where they need to be.</p>
<pre class="r"><code>fs::file_move(path = gap_files, new_path = gap_path)</code></pre>
<p>After we’ve moved the files, we can check to see if it worked with the <code>dir:tree()</code> function again, but we’ll add the <code>recurse = FALSE</code> to limit the output.</p>
</div>
<div id="coloring-file-paths" class="section level2">
<h2>Coloring file paths</h2>
<pre class="r"><code>fs::dir_tree(path = gap_path, recurse = FALSE)</code></pre>
<pre class="r"><code>datasets/gapminder
├── gapminder2007.csv
├── gapminderDataFiveYear.csv
├── gapminderDataFiveYear2.csv
├── gapminderData_Americas_2007.csv
├── gapminder_unfiltered.csv
└── gapminder_with_codes.csv</code></pre>
<p>In the RStudio IDE, the output is colored by file type.</p>
<p><img src="/post/2019-10-11-tidy-file-management_files/dir-tree.jpg" style="width:50.0%;height:50.0%" /></p>
</div>
<div id="get-folder-info" class="section level2">
<h2>Get folder info</h2>
<p><code>fs</code> also has some great functions for getting information for the files in each folder. For example, check out the <code>fs::dir_info()</code> function below:</p>
<pre class="r"><code>fs::dir_info(&quot;datasets&quot;) %&gt;% 
    dplyr::glimpse()</code></pre>
<pre class="r"><code>Observations: 149
Variables: 18
$ path              &lt;fs::path&gt; &quot;datasets/1962_2006_walmart_store_openings.c…
$ type              &lt;fct&gt; file, file, file, file, file, file, file, file, f…
$ size              &lt;fs::bytes&gt; 310.02K, 2.55K, 10.82K, 15.5K, 5.17K, 5.36K…
$ permissions       &lt;fs::perms&gt; rwxr-xr-x, rwxr-xr-x, rwxr-xr-x, rwxr-xr-x,…
$ modification_time &lt;dttm&gt; 2019-08-27 13:31:08, 2019-08-27 13:31:08, 2019-0…
$ user              &lt;chr&gt; &quot;martinfrigaard&quot;, &quot;martinfrigaard&quot;, &quot;martinfrigaa…
$ group             &lt;chr&gt; &quot;staff&quot;, &quot;staff&quot;, &quot;staff&quot;, &quot;staff&quot;, &quot;staff&quot;, &quot;sta…
$ device_id         &lt;dbl&gt; 16777220, 16777220, 16777220, 16777220, 16777220,…
$ hard_links        &lt;dbl&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1…
$ special_device_id &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0…
$ inode             &lt;dbl&gt; 32132013, 32132014, 32132015, 32132016, 32132017,…
$ block_size        &lt;dbl&gt; 4096, 4096, 4096, 4096, 4096, 4096, 4096, 4096, 4…
$ blocks            &lt;dbl&gt; 624, 8, 24, 32, 16, 16, 8, 264, 8, 16, 784, 8, 89…
$ flags             &lt;int&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0…
$ generation        &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0…
$ access_time       &lt;dttm&gt; 2019-10-11 16:51:51, 2019-10-11 16:51:50, 2019-1…
$ change_time       &lt;dttm&gt; 2019-10-11 16:51:50, 2019-10-11 16:51:50, 2019-1…
$ birth_time        &lt;dttm&gt; 2019-08-27 13:31:08, 2019-08-27 13:31:08, 2019-0…</code></pre>
<p>These variables are helpful if you’re trying to determine file sizes. Let’s limit the info to the top ten.</p>
<pre class="r"><code>fs::dir_info(&quot;datasets&quot;) %&gt;% 
    dplyr::arrange(desc(size)) %&gt;% 
    dplyr::select(path, size, modification_time) %&gt;% 
    utils::head(10) </code></pre>
<pre class="r"><code># A tibble: 10 x 3
   path                                        size modification_time  
   &lt;fs::path&gt;                           &lt;fs::bytes&gt; &lt;dttm&gt;             
 1 datasets/processed_data.csv               86.28M 2019-08-27 13:31:08
 2 datasets/uber-rides-data3.csv             55.89M 2019-08-27 13:31:08
 3 datasets/uber-rides-data2.csv             55.89M 2019-08-27 13:31:08
 4 datasets/uber-rides-data1.csv             55.89M 2019-08-27 13:31:08
 5 datasets/flightdata.csv                   28.58M 2019-08-27 13:31:08
 6 datasets/data.csv                          6.18M 2019-08-27 13:31:08
 7 datasets/26k-consumer-complaints.csv       4.54M 2019-08-27 13:31:08
 8 datasets/geojson-counties-fips.json        3.07M 2019-08-27 13:31:08
 9 datasets/clustergram_GDS5373.soft          2.59M 2019-08-27 13:31:08
10 datasets/data.csv.zip                      2.27M 2019-08-27 13:31:08</code></pre>
<p>This is helpful if we’re trying to organize data files by <code>size</code>, or the time they were last modified with <code>modification_time</code>.</p>
</div>
<div id="importing-files" class="section level2">
<h2>Importing files</h2>
<p>We can also use the <code>fs</code> package to import multiple files into a single data frame. If we combine all the <code>uber</code> files into a <code>fs_path</code>, and then combine this with the <code>purrr:map_df()</code> function, we can import all the files with <code>readr::read_csv()</code> (and some additional arguments).</p>
<pre class="r"><code># create file paths
uber_files &lt;- fs::dir_ls(path = &quot;datasets&quot;, 
                         regexp = &quot;uber&quot;)
# import
UberData &lt;- uber_files %&gt;%
  purrr::map_df(read_csv, 
                .id = &quot;file&quot;, 
         col_types = cols())</code></pre>
<pre class="r"><code># A tibble: 10 x 4
   file                          `Date/Time`           Lat   Lon
   &lt;chr&gt;                         &lt;dttm&gt;              &lt;dbl&gt; &lt;dbl&gt;
 1 datasets/uber-rides-data1.csv 2014-04-01 00:11:00  40.8 -74.0
 2 datasets/uber-rides-data1.csv 2014-04-01 00:17:00  40.7 -74.0
 3 datasets/uber-rides-data1.csv 2014-04-01 00:21:00  40.7 -74.0
 4 datasets/uber-rides-data1.csv 2014-04-01 00:28:00  40.8 -74.0
 5 datasets/uber-rides-data1.csv 2014-04-01 00:33:00  40.8 -74.0
 6 datasets/uber-rides-data1.csv 2014-04-01 00:33:00  40.7 -74.0
 7 datasets/uber-rides-data1.csv 2014-04-01 00:39:00  40.7 -74.0
 8 datasets/uber-rides-data1.csv 2014-04-01 00:45:00  40.8 -74.0
 9 datasets/uber-rides-data1.csv 2014-04-01 00:55:00  40.8 -74.0
10 datasets/uber-rides-data1.csv 2014-04-01 01:01:00  40.8 -74.0</code></pre>
<div id="exporting-files" class="section level3">
<h3>Exporting files</h3>
<p>In the same way the files were imported using the <code>fs</code>, we can plit and export the files. Let’s assume we’re collaborating with someone who wants the data in a tab-deliminted format. Well, we can split this new <code>UberData</code> into three files with the <code>.tsv</code> extension.</p>
<pre class="r"><code>UberData %&gt;% 
  # split files for each file
  base::split(.$file) %&gt;%
    # map select across the df, but remove &#39;file&#39;
  purrr::map(dplyr::select, -file) %&gt;%
    # walk the readr::write_tsv() function across df, 
    # but also change the file path to end with &#39;,tsv&#39;
  purrr::iwalk(~ write_tsv(x = .x, path = 
                        stringr::str_replace_all(string = .y,
                                                 pattern = &quot;.csv&quot;,
                                                 replacement = &quot;.tsv&quot;)))</code></pre>
<p>We can confirm this with the <code>fs::dir_tree()</code> function again.</p>
<pre class="r"><code>fs::dir_tree(path = &quot;datasets&quot;, regex = &quot;uber&quot;)</code></pre>
<pre class="r"><code>datasets
├── uber-rides-data1.csv
├── uber-rides-data1.tsv
├── uber-rides-data2.csv
├── uber-rides-data2.tsv
├── uber-rides-data3.csv
└── uber-rides-data3.tsv</code></pre>
<p>And we can see these files are colored to help us see if the export worked.</p>
<p><img src="/post/2019-10-11-tidy-file-management_files/dir-tree-02.jpg" /></p>
</div>
</div>
<div id="end" class="section level2">
<h2>End</h2>
<p>There you have it! Check out the <a href="https://fs.r-lib.org/">package website</a> for more information.</p>
</div>
