<!DOCTYPE html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="/css/fonts.css">
    
    <title>Tidyverse Tips</title>
    <link rel="icon" type="image/png" href="/assets/img/favicon.ico" />
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.2/css/all.css"
        integrity="sha384-oS3vJWv+0UjzBfQzYUhtDYW+Pj2yciDJxpsK1OYPAYjqT085Qq/1cq5FLXAZQ7Ay" crossorigin="anonymous">
    <script src="/js/dark.js" defer=""></script>

</head>

<html>
<!DOCTYPE html>
<html>

<body>
  <header class="site-header">

    <div class="wrapper">
      <a class="muted small" href="https://www.tidyverse.tips/">Tidyverse Tips</a>
    </div>
  </header>
</body>

</html>
<h1>Creating an R package</h1>
<p class="post-meta"><time itemprop="datePublished">April 8, 2021</time>
</p>
<p>This post is going to cover how to convert the <code>split_into_multiple()</code> function we wrote in the <a href="https://www.tidyverse.tips/posts/2021-03-14-how-to-write-a-custom-wrangling-function/">last post</a> into a small R package. Read more about writing R packages in the <a href="https://r-pkgs.org/index.html">R packages book</a></p>
<h2 id="install-and-load-the-necessary-packages">Install and load the necessary packages</h2>
<p>Run the code below to install and load the necessary packages</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#75715e"># install</span>
<span style="color:#a6e22e">install.packages</span>(<span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;devtools&#34;</span>, <span style="color:#e6db74">&#34;roxygen2&#34;</span>, <span style="color:#e6db74">&#34;testthat&#34;</span>, <span style="color:#e6db74">&#34;knitr&#34;</span>,
                   <span style="color:#e6db74">&#34;tidyverse&#34;</span>, <span style="color:#e6db74">&#34;fs&#34;</span>, <span style="color:#e6db74">&#34;withr&#34;</span>))
<span style="color:#75715e"># load </span>
<span style="color:#a6e22e">library</span>(devtools)
<span style="color:#a6e22e">library</span>(roxygen2)
<span style="color:#a6e22e">library</span>(testthat)
<span style="color:#a6e22e">library</span>(knitr)
<span style="color:#a6e22e">library</span>(tidyverse)
<span style="color:#a6e22e">library</span>(fs)
<span style="color:#a6e22e">library</span>(withr)
</code></pre></div><h2 id="creating-the-package">Creating the package</h2>
<p>We&rsquo;ll use the IDE to create our new package by clicking on <em>Project</em> &gt; <em>New Project</em> &gt; <em>R package</em>, and then fill in the necessary information. We are going to call this package <code>diyrrr</code> (for do-it-yourself R).</p>
<!-- raw HTML omitted -->
<p><img src="https://raw.githubusercontent.com/mjfrigaard/tidyverse-tips/master/content/posts/2021-04-08-creating-an-r-package/images/diyrrr-pkg-01.jpg" alt=""></p>
<p>After clicking on <em>Create Project</em>, a new R session will open with the following contents:</p>
<p><img src="https://raw.githubusercontent.com/mjfrigaard/tidyverse-tips/master/content/posts/2021-04-08-creating-an-r-package/images/diyrrr-pkg-02.jpg" alt=""></p>
<!-- raw HTML omitted -->
<h3 id="package-contents">Package contents</h3>
<p>Below is a folder tree of our new package files.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">diyrrr<span style="color:#f92672">/</span>
    ├── DESCRIPTION
    ├── NAMESPACE
    ├── R
    │   └── hello.R
    ├── diyrrr.Rproj
    └── man
        └── hello.Rd
</code></pre></div><p>The DESCRIPTION and NAMESPACE are plain text files. The <code>R/</code> folder has a single script file in it (<code>hello.R</code>). There is also an associated <code>man/</code> folder with a R documentation file for the .R file (<code>hello.Rd</code>).</p>
<h2 id="using-git">Using Git</h2>
<p>We checked the <em>Create a git repository</em> option when we created this package (odds are will want to collaborate and get feedback), but we want to make sure this folder is set up properly (and that the appropriate files/extensions are added to the <code>.gitignore</code>). We can do this by running the <code>usethis::use_git()</code> function (no additional arguments)</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#f92672">&gt;</span> usethis<span style="color:#f92672">::</span><span style="color:#a6e22e">use_git</span>()
✓ Setting active project to <span style="color:#e6db74">&#39;/Documents/diyrrr&#39;</span>
✓ Adding <span style="color:#e6db74">&#39;.Rdata&#39;</span>, <span style="color:#e6db74">&#39;.httr-oauth&#39;</span>, <span style="color:#e6db74">&#39;.DS_Store&#39;</span> to <span style="color:#e6db74">&#39;.gitignore&#39;</span>
There are <span style="color:#ae81ff">7</span> uncommitted files<span style="color:#f92672">:</span>
<span style="color:#f92672">*</span> <span style="color:#e6db74">&#39;.gitignore&#39;</span>
<span style="color:#f92672">*</span> <span style="color:#e6db74">&#39;.Rbuildignore&#39;</span>
<span style="color:#f92672">*</span> <span style="color:#e6db74">&#39;DESCRIPTION&#39;</span>
<span style="color:#f92672">*</span> <span style="color:#e6db74">&#39;diyrrr.Rproj&#39;</span>
<span style="color:#f92672">*</span> <span style="color:#e6db74">&#39;man/&#39;</span>
<span style="color:#f92672">*</span> <span style="color:#e6db74">&#39;NAMESPACE&#39;</span>
<span style="color:#f92672">*</span> <span style="color:#e6db74">&#39;R/&#39;</span>
Is it ok to commit them<span style="color:#f92672">?</span>

<span style="color:#ae81ff">1</span><span style="color:#f92672">:</span> Absolutely
<span style="color:#ae81ff">2</span><span style="color:#f92672">:</span> No way
<span style="color:#ae81ff">3</span><span style="color:#f92672">:</span> Nope
</code></pre></div><p>We <code>Absolutely</code> want to do this, so we&rsquo;ll type <code>1</code> and hit enter:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">Selection<span style="color:#f92672">:</span> <span style="color:#ae81ff">1</span>
✓ Adding files
✓ Making a commit with message <span style="color:#e6db74">&#39;Initial commit&#39;</span>
</code></pre></div><p><code>usethis::use_git()</code> was nice enough to add all the files to the repo and include a commit message. We can check the content from these functions in the Terminal with <code>git log</code> and <code>git status</code></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ git log
commit fe0c921fae6a42e8fb11408eb9692d0f46a8af3d <span style="color:#f92672">(</span>HEAD -&gt; master<span style="color:#f92672">)</span>
Author: Martin J Frigaard &lt;mjfrigaard@gmail.com&gt;
Date:   Fri Apr <span style="color:#ae81ff">9</span> 07:04:58 <span style="color:#ae81ff">2021</span> -0700

    Initial commit
$ git status
On branch master
nothing to commit, working tree clean
</code></pre></div><h2 id="write-our-function">Write our function</h2>
<p>In the previous post, we a function for splitting a single column containing multiple pieces of information into an <em>unknown</em> number of new columns. After some reflection, we&rsquo;ve decided we&rsquo;re going to pick a better name for this function.</p>
<p>It&rsquo;s similar to tidyr::separate(), but with an known number of <code>cols</code>, so we will call it <code>separate_uk_cols</code> (for <em>separate unknown columns</em>)</p>
<p>To create this function, we use <code>usethis::use_r(&quot;separate_uk_cols&quot;)</code></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">usethis<span style="color:#f92672">::</span><span style="color:#a6e22e">use_r</span>(<span style="color:#e6db74">&#34;separate_uk_cols&#34;</span>)
✓ Setting active project to <span style="color:#e6db74">&#39;@r-packages/diyrrr&#39;</span>
● Modify <span style="color:#e6db74">&#39;R/separate_uk_cols.R&#39;</span>
● Call <span style="color:#a6e22e">`use_test</span>()` to create a matching test file
</code></pre></div><p>This creates and opens a <code>R/separate_uk_cols.R</code> file, and we will put the code below into our new script:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">separate_uk_cols <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">function</span>(data, col, pattern <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;[^[:alnum:]]+&#34;</span>, into_prefix) {
  in_pattern <span style="color:#f92672">&lt;-</span> pattern
  in_data <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">as_tibble</span>(data)
  in_col <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">as.character</span>(col)
  out_cols <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">str_split_fixed</span>(in_data[[in_col]],
    pattern <span style="color:#f92672">=</span> in_pattern,
    n <span style="color:#f92672">=</span> <span style="color:#66d9ef">Inf</span>
  )
  out_cols<span style="color:#a6e22e">[which</span>(out_cols <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;&#34;</span>)] <span style="color:#f92672">&lt;-</span> <span style="color:#66d9ef">NA</span>
  m <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">dim</span>(out_cols)[2]
  <span style="color:#a6e22e">colnames</span>(out_cols) <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">paste</span>(into_prefix, <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span>m, sep <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;_&#34;</span>)
  out_cols <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">as_tibble</span>(out_cols)
  out_tibble <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">bind_cols</span>(in_data, out_cols)
  <span style="color:#a6e22e">return</span>(out_tibble)
}
</code></pre></div><p>We removed the comments (below), but we will use these for documentation later :)</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#75715e"># use regex for pattern, or whatever is provided</span>
<span style="color:#75715e"># convert data to tibble</span>
<span style="color:#75715e"># convert col to character vector</span>
<span style="color:#75715e"># split columns into character matrix</span>
<span style="color:#75715e"># replace NAs in matrix</span>
<span style="color:#75715e"># get number of cols</span>
<span style="color:#75715e"># assign column names</span>
<span style="color:#75715e"># convert to tibble</span>
<span style="color:#75715e"># bind cols together</span>
<span style="color:#75715e"># return the out_tibble</span>
</code></pre></div><p>As we can see, this function uses the <code>tibble</code>, <code>stringr</code> and <code>dplyr</code> packages, so we need to add these to the <code>DESCRIPTION</code> file using the <code>usethis::use_package()</code> function:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#f92672">&gt;</span> usethis<span style="color:#f92672">::</span><span style="color:#a6e22e">use_package</span>(package <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;tibble&#34;</span>)
✓ Adding <span style="color:#e6db74">&#39;tibble&#39;</span> to Imports field in DESCRIPTION
● Refer to functions with `tibble::fun()`
<span style="color:#f92672">&gt;</span> usethis<span style="color:#f92672">::</span><span style="color:#a6e22e">use_package</span>(package <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;dplyr&#34;</span>)
✓ Adding <span style="color:#e6db74">&#39;dplyr&#39;</span> to Imports field in DESCRIPTION
● Refer to functions with `dplyr::fun()`
<span style="color:#f92672">&gt;</span> usethis<span style="color:#f92672">::</span><span style="color:#a6e22e">use_package</span>(package <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;stringr&#34;</span>)
✓ Adding <span style="color:#e6db74">&#39;stringr&#39;</span> to Imports field in DESCRIPTION
● Refer to functions with `stringr::fun()`
</code></pre></div><p>We see an <code>Imports:</code> section has been added to the <code>DESCRIPTION</code> file with the three packages we&rsquo;ve included.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ cat DESCRIPTION 
Package: diyrrr
Type: Package
Title: What the Package Does <span style="color:#f92672">(</span>Title Case<span style="color:#f92672">)</span>
Version: 0.1.0
Author: Who wrote it
Maintainer: The package maintainer &lt;yourself@somewhere.net&gt;
Description: More about what it does <span style="color:#f92672">(</span>maybe more than one line<span style="color:#f92672">)</span>
    Use four spaces when indenting paragraphs within the Description.
License: What license is it under?
Encoding: UTF-8
LazyData: true
Imports: 
    dplyr,
    stringr,
    tibble
</code></pre></div><p>The output tells us we need to add the <code>package::function()</code> syntax for the three imported functions (<code>tibble</code>, <code>dplyr</code>, <code>stringr</code>):</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">separate_uk_cols <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">function</span>(data, col, pattern <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;[^[:alnum:]]+&#34;</span>, into_prefix) {
  in_pattern <span style="color:#f92672">&lt;-</span> pattern
  in_data <span style="color:#f92672">&lt;-</span> tibble<span style="color:#f92672">::</span><span style="color:#a6e22e">as_tibble</span>(data)
  in_col <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">as.character</span>(col)
  out_cols <span style="color:#f92672">&lt;-</span> stringr<span style="color:#f92672">::</span><span style="color:#a6e22e">str_split_fixed</span>(in_data[[in_col]],
    pattern <span style="color:#f92672">=</span> in_pattern,
    n <span style="color:#f92672">=</span> <span style="color:#66d9ef">Inf</span>
  )
  out_cols<span style="color:#a6e22e">[which</span>(out_cols <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;&#34;</span>)] <span style="color:#f92672">&lt;-</span> <span style="color:#66d9ef">NA</span>
  m <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">dim</span>(out_cols)[2]
  <span style="color:#a6e22e">colnames</span>(out_cols) <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">paste</span>(into_prefix, <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span>m, sep <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;_&#34;</span>)
  out_cols <span style="color:#f92672">&lt;-</span> tibble<span style="color:#f92672">::</span><span style="color:#a6e22e">as_tibble</span>(out_cols)
  out_tibble <span style="color:#f92672">&lt;-</span> dplyr<span style="color:#f92672">::</span><span style="color:#a6e22e">bind_cols</span>(in_data, out_cols)
  <span style="color:#a6e22e">return</span>(out_tibble)
}
</code></pre></div><h2 id="inserting-the-roxygen-skeleton">Inserting the Roxygen skeleton</h2>
<p>With our cursor placed inside the <code>separate_uk_cols()</code> function, we can navigate to the toolbar and under the <em>&lsquo;Code&rsquo;</em> option, we will select the <em>&lsquo;Insert Roxygen skeleton&rsquo;</em> option.</p>
<!-- raw HTML omitted -->
<p><img src="https://raw.githubusercontent.com/mjfrigaard/tidyverse-tips/master/content/posts/2021-04-08-creating-an-r-package/images/diyrrr-pkg-03.jpg" alt=""></p>
<p>This inserts the following code at the top of the <code>R/separate_uk_cols.R</code> file:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#75715e">#&#39; Title</span>
<span style="color:#75715e">#&#39;</span>
<span style="color:#75715e">#&#39; @param data</span>
<span style="color:#75715e">#&#39; @param col</span>
<span style="color:#75715e">#&#39; @param pattern</span>
<span style="color:#75715e">#&#39; @param into_prefix</span>
<span style="color:#75715e">#&#39;</span>
<span style="color:#75715e">#&#39; @return</span>
<span style="color:#75715e">#&#39; @export</span>
<span style="color:#75715e">#&#39;</span>
<span style="color:#75715e">#&#39; @examples</span>
</code></pre></div><p>The <code>Title</code> can be changed to <code>separate_uk_cols</code>.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#75715e">#&#39; separate_uk_cols</span>
</code></pre></div><p>The <code>@param</code> tags need a <code>name</code> and a <code>description</code>, we we include below:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#75715e">#&#39; @param data data.frame or tibble</span>
<span style="color:#75715e">#&#39; @param col column to be separated</span>
<span style="color:#75715e">#&#39; @param pattern regular expression pattern</span>
<span style="color:#75715e">#&#39; @param into_prefix prefix for new columns</span>
</code></pre></div><p>The <code>@export</code> tag is set to <code>separate_uk_cols</code></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#75715e">#&#39; @export separate_uk_cols</span>
</code></pre></div><p>We will remove the <code>@return</code> and <code>@example</code> tags from the <code>separate_uk_cols.R</code> file and use the <code>devtools::document()</code> function (wrapper for  <code>roxygen2::roxygenize()</code>) to include the documentation for  <code>separate_uk_cols()</code>.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#f92672">&gt;</span> devtools<span style="color:#f92672">::</span><span style="color:#a6e22e">document</span>()
ℹ Updating diyrrr documentation
First time using roxygen2. Upgrading automatically...
Updating roxygen version in <span style="color:#f92672">/</span>Users<span style="color:#f92672">/</span>mjfrigaard<span style="color:#f92672">/</span>Documents<span style="color:#f92672">/</span>diyrrr<span style="color:#f92672">/</span>DESCRIPTION
ℹ Loading diyrrr
Warning<span style="color:#f92672">:</span> The existing <span style="color:#e6db74">&#39;NAMESPACE&#39;</span> file was not generated by roxygen2, and will not be overwritten.
Writing separate_uk_cols.Rd
</code></pre></div><p>We see that <code>devtools::document()</code> updated our version of <code>roxygen2</code>, and we receive a warning telling us that the <code>NAMESPACE</code> file will not be overwritten because we created it when we build the package. Let&rsquo;s open this file and check it&rsquo;s contents:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ cat NAMESPACE 
exportPattern<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;^[[:alpha:]]+&#34;</span><span style="color:#f92672">)</span>
</code></pre></div><p>Because there is only a single line in our <code>NAMESPACE</code>, we will remove this file and re-run <code>devtools::document()</code> so it will generate (and overwrite) it&rsquo;s contents.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">unlink</span>(x <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;NAMESPACE&#34;</span>)
<span style="color:#f92672">&gt;</span> devtools<span style="color:#f92672">::</span><span style="color:#a6e22e">document</span>()
ℹ Updating diyrrr documentation
ℹ Loading diyrrr
Writing NAMESPACE
</code></pre></div><h3 id="rd-contents">.Rd contents</h3>
<p>Below is the contents of the <code>man/separate_uk_cols.Rd</code> file that was generated using the <code>@tags</code> in the <code>separate_uk_cols.R</code> file when we ran the <code>devtools::document()</code> function:</p>
<pre><code>% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/separate_uk_cols.R
\name{separate_uk_cols}
\alias{separate_uk_cols}
\title{separate_uk_cols}
\usage{
separate_uk_cols(data, col, pattern = &quot;[^[:alnum:]]+&quot;, into_prefix)
}
\arguments{
\item{data}{data.frame or tibble}

\item{col}{column to be separated}

\item{pattern}{regular expression pattern}

\item{into_prefix}{prefix for new columns}
}
\description{
separate_uk_cols
}
</code></pre><p>The <code>NAMESPACE</code> also includes <code>export(separate_uk_cols)</code></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ cat NAMESPACE 
<span style="color:#75715e"># Generated by roxygen2: do not edit by hand</span>

export<span style="color:#f92672">(</span>separate_uk_cols<span style="color:#f92672">)</span>
</code></pre></div><h2 id="checking-the-package">Checking the package</h2>
<p>Finally, we will run <code>devtools::check()</code> (<em><code>check</code> automatically builds and checks a source package, using all known best practices.</em>)</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#f92672">&gt;</span> devtools<span style="color:#f92672">::</span><span style="color:#a6e22e">check</span>()
ℹ Updating diyrrr documentation
ℹ Loading diyrrr
Writing NAMESPACE
Writing NAMESPACE
── Building ──────────────────────────────────────────────────────────────────────── diyrrr ──
Setting env vars<span style="color:#f92672">:</span>
● CFLAGS    <span style="color:#f92672">:</span> <span style="color:#f92672">-</span>Wall <span style="color:#f92672">-</span>pedantic <span style="color:#f92672">-</span>fdiagnostics<span style="color:#f92672">-</span>color<span style="color:#f92672">=</span>always
● CXXFLAGS  <span style="color:#f92672">:</span> <span style="color:#f92672">-</span>Wall <span style="color:#f92672">-</span>pedantic <span style="color:#f92672">-</span>fdiagnostics<span style="color:#f92672">-</span>color<span style="color:#f92672">=</span>always
● CXX11FLAGS<span style="color:#f92672">:</span> <span style="color:#f92672">-</span>Wall <span style="color:#f92672">-</span>pedantic <span style="color:#f92672">-</span>fdiagnostics<span style="color:#f92672">-</span>color<span style="color:#f92672">=</span>always
──────────────────────────────────────────────────────────────────────────────────────────────
✓  checking for file ‘<span style="color:#f92672">/</span>Documents<span style="color:#f92672">/</span>diyrrr<span style="color:#f92672">/</span>DESCRIPTION’ (<span style="color:#ae81ff">414</span>ms)
─  preparing ‘diyrrr’<span style="color:#f92672">:</span>
✓  checking DESCRIPTION meta<span style="color:#f92672">-</span>information
─  checking for LF line<span style="color:#f92672">-</span>endings in source and make files and shell scripts
─  checking for empty or unneeded directories
─  building ‘diyrrr_0.1.0.tar.gz’
   
── Checking ──────────────────────────────────────────────────────────────────────── diyrrr ──
Setting env vars<span style="color:#f92672">:</span>
● _R_CHECK_CRAN_INCOMING_REMOTE_<span style="color:#f92672">:</span> <span style="color:#66d9ef">FALSE</span>
● _R_CHECK_CRAN_INCOMING_       <span style="color:#f92672">:</span> <span style="color:#66d9ef">FALSE</span>
● _R_CHECK_FORCE_SUGGESTS_      <span style="color:#f92672">:</span> <span style="color:#66d9ef">FALSE</span>
● NOT_CRAN                      <span style="color:#f92672">:</span> true
── R CMD check ───────────────────────────────────────────────────────────────────────────────
─  using log directory ‘<span style="color:#f92672">/</span>private<span style="color:#f92672">/</span>var<span style="color:#f92672">/</span>folders<span style="color:#f92672">/</span><span style="color:#ae81ff">3</span>p<span style="color:#f92672">/</span>wzkys03s6p1cvmn8yzm934400000gn<span style="color:#f92672">/</span>T<span style="color:#f92672">/</span>RtmpLTecoQ<span style="color:#f92672">/</span>diyrrr.Rcheck’
─  using R version <span style="color:#ae81ff">4.0.5</span> (<span style="color:#ae81ff">2021-03-31</span>)
─  using platform<span style="color:#f92672">:</span> x86_64<span style="color:#f92672">-</span>apple<span style="color:#f92672">-</span><span style="color:#a6e22e">darwin17.0 </span>(<span style="color:#ae81ff">64</span><span style="color:#f92672">-</span>bit)
─  using session charset<span style="color:#f92672">:</span> UTF<span style="color:#ae81ff">-8</span>
─  using options ‘<span style="color:#f92672">--</span>no<span style="color:#f92672">-</span>manual <span style="color:#f92672">--</span>as<span style="color:#f92672">-</span>cran’
✓  checking for file ‘diyrrr<span style="color:#f92672">/</span>DESCRIPTION’
─  checking extension type <span style="color:#66d9ef">...</span> Package
─  this is package ‘diyrrr’ version ‘<span style="color:#ae81ff">0.1.0</span>’
─  package encoding<span style="color:#f92672">:</span> UTF<span style="color:#ae81ff">-8</span>
✓  checking package namespace information <span style="color:#66d9ef">...</span>
✓  checking package <span style="color:#a6e22e">dependencies </span>(<span style="color:#ae81ff">1.3</span>s)
✓  checking if this is a source package
✓  checking if there is a namespace
✓  checking for executable files <span style="color:#66d9ef">...</span>
✓  checking for hidden files and directories
✓  checking for portable file names
✓  checking for sufficient<span style="color:#f92672">/</span>correct file permissions
✓  checking serialization versions
✓  checking whether package ‘diyrrr’ can be <span style="color:#a6e22e">installed </span>(<span style="color:#ae81ff">1.5</span>s)
✓  checking installed package size <span style="color:#66d9ef">...</span>
✓  checking package directory <span style="color:#66d9ef">...</span>
✓  checking for future file <span style="color:#a6e22e">timestamps </span>(<span style="color:#ae81ff">1.3</span>s)
W  checking DESCRIPTION meta<span style="color:#f92672">-</span>information <span style="color:#66d9ef">...</span>
   Non<span style="color:#f92672">-</span>standard license specification<span style="color:#f92672">:</span>
     What license is it under<span style="color:#f92672">?</span>
   Standardizable<span style="color:#f92672">:</span> <span style="color:#66d9ef">FALSE</span>
✓  checking top<span style="color:#f92672">-</span>level files
✓  checking for left<span style="color:#f92672">-</span>over files
✓  checking index information
✓  checking package subdirectories <span style="color:#66d9ef">...</span>
✓  checking R files for non<span style="color:#f92672">-</span>ASCII characters <span style="color:#66d9ef">...</span>
✓  checking R files for syntax errors <span style="color:#66d9ef">...</span>
✓  checking whether the package can be loaded <span style="color:#66d9ef">...</span>
✓  checking whether the package can be loaded with stated dependencies <span style="color:#66d9ef">...</span>
✓  checking whether the package can be unloaded cleanly <span style="color:#66d9ef">...</span>
✓  checking whether the namespace can be loaded with stated dependencies <span style="color:#66d9ef">...</span>
✓  checking whether the namespace can be unloaded cleanly <span style="color:#66d9ef">...</span>
✓  checking loading without being on the library search path <span style="color:#66d9ef">...</span>
✓  checking dependencies in R <span style="color:#a6e22e">code </span>(<span style="color:#ae81ff">833</span>ms)
✓  checking S3 generic<span style="color:#f92672">/</span>method <span style="color:#a6e22e">consistency </span>(<span style="color:#ae81ff">485</span>ms)
✓  checking replacement functions <span style="color:#66d9ef">...</span>
✓  checking foreign function calls <span style="color:#66d9ef">...</span>
✓  checking R code for possible <span style="color:#a6e22e">problems </span>(<span style="color:#ae81ff">1.9</span>s)
✓  checking Rd files <span style="color:#66d9ef">...</span>
✓  checking Rd metadata <span style="color:#66d9ef">...</span>
✓  checking Rd line widths <span style="color:#66d9ef">...</span>
✓  checking Rd cross<span style="color:#f92672">-</span>references <span style="color:#66d9ef">...</span>
✓  checking for missing documentation entries <span style="color:#66d9ef">...</span>
✓  checking for code<span style="color:#f92672">/</span>documentation <span style="color:#a6e22e">mismatches </span>(<span style="color:#ae81ff">436</span>ms)
✓  checking Rd \usage <span style="color:#a6e22e">sections </span>(<span style="color:#ae81ff">1.1</span>s)
✓  checking Rd <span style="color:#a6e22e">contents </span>(<span style="color:#ae81ff">982</span>ms)
✓  checking for unstated dependencies in examples <span style="color:#66d9ef">...</span>
E  checking <span style="color:#a6e22e">examples </span>(<span style="color:#ae81ff">830</span>ms)
   Running examples in ‘diyrrr<span style="color:#f92672">-</span>Ex.R’ failed
   The error most likely occurred in<span style="color:#f92672">:</span>
   
   <span style="color:#f92672">&gt;</span> base<span style="color:#f92672">::</span><span style="color:#a6e22e">assign</span>(<span style="color:#e6db74">&#34;.ptime&#34;</span>, <span style="color:#a6e22e">proc.time</span>(), pos <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;CheckExEnv&#34;</span>)
   <span style="color:#f92672">&gt;</span> <span style="color:#75715e">### Name: hello</span>
   <span style="color:#f92672">&gt;</span> <span style="color:#75715e">### Title: Hello, World!</span>
   <span style="color:#f92672">&gt;</span> <span style="color:#75715e">### Aliases: hello</span>
   <span style="color:#f92672">&gt;</span> 
   <span style="color:#f92672">&gt;</span> <span style="color:#75715e">### ** Examples</span>
   <span style="color:#f92672">&gt;</span> 
   <span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">hello</span>()
   Error in <span style="color:#a6e22e">hello</span>() <span style="color:#f92672">:</span> could not find function <span style="color:#e6db74">&#34;hello&#34;</span>
   Execution halted
✓  checking for non<span style="color:#f92672">-</span>standard things in the check directory
✓  checking for detritus in the temp directory
   
   See
     ‘<span style="color:#f92672">/</span>private<span style="color:#f92672">/</span>var<span style="color:#f92672">/</span>folders<span style="color:#f92672">/</span><span style="color:#ae81ff">3</span>p<span style="color:#f92672">/</span>wzkys03s6p1cvmn8yzm934400000gn<span style="color:#f92672">/</span>T<span style="color:#f92672">/</span>RtmpLTecoQ<span style="color:#f92672">/</span>diyrrr.Rcheck<span style="color:#f92672">/</span><span style="color:#ae81ff">00</span>check.log’
   for details.
   
── R CMD check results ───────────────────────────────────────────────────── diyrrr <span style="color:#ae81ff">0.1.0</span> ────
Duration<span style="color:#f92672">:</span> <span style="color:#ae81ff">13.9</span>s

<span style="color:#f92672">&gt;</span> checking examples <span style="color:#66d9ef">...</span> ERROR
  Running examples in ‘diyrrr<span style="color:#f92672">-</span>Ex.R’ failed
  The error most likely occurred in<span style="color:#f92672">:</span>
  
  <span style="color:#f92672">&gt;</span> base<span style="color:#f92672">::</span><span style="color:#a6e22e">assign</span>(<span style="color:#e6db74">&#34;.ptime&#34;</span>, <span style="color:#a6e22e">proc.time</span>(), pos <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;CheckExEnv&#34;</span>)
  <span style="color:#f92672">&gt;</span> <span style="color:#75715e">### Name: hello</span>
  <span style="color:#f92672">&gt;</span> <span style="color:#75715e">### Title: Hello, World!</span>
  <span style="color:#f92672">&gt;</span> <span style="color:#75715e">### Aliases: hello</span>
  <span style="color:#f92672">&gt;</span> 
  <span style="color:#f92672">&gt;</span> <span style="color:#75715e">### ** Examples</span>
  <span style="color:#f92672">&gt;</span> 
  <span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">hello</span>()
  Error in <span style="color:#a6e22e">hello</span>() <span style="color:#f92672">:</span> could not find function <span style="color:#e6db74">&#34;hello&#34;</span>
  Execution halted

<span style="color:#f92672">&gt;</span> checking DESCRIPTION meta<span style="color:#f92672">-</span>information <span style="color:#66d9ef">...</span> WARNING
  Non<span style="color:#f92672">-</span>standard license specification<span style="color:#f92672">:</span>
    What license is it under<span style="color:#f92672">?</span>
  Standardizable<span style="color:#f92672">:</span> <span style="color:#66d9ef">FALSE</span>

<span style="color:#ae81ff">1</span> error x <span style="color:#f92672">|</span> <span style="color:#ae81ff">1</span> warning x <span style="color:#f92672">|</span> <span style="color:#ae81ff">0</span> notes ✓
</code></pre></div><p>We can see the package has <code>1 error</code> and <code>1 warning</code>. The error is being generated by our boilerplate <code>hello.R</code> and <code>hello.Rd</code> files (which we can remove):</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">unlink</span>(<span style="color:#e6db74">&#34;R/hello.R&#34;</span>)
<span style="color:#a6e22e">unlink</span>(<span style="color:#e6db74">&#34;man/hello.Rd&#34;</span>)
</code></pre></div><p>We can address the warning (<code>Non-standard license specification</code>) with the <code>usethis::use_mit_license()</code> function:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">usethis<span style="color:#f92672">::</span><span style="color:#a6e22e">use_mit_license</span>()
✓ Setting License field in DESCRIPTION to <span style="color:#e6db74">&#39;MIT + file LICENSE&#39;</span>
✓ Writing <span style="color:#e6db74">&#39;LICENSE&#39;</span>
✓ Writing <span style="color:#e6db74">&#39;LICENSE.md&#39;</span>
✓ Adding <span style="color:#e6db74">&#39;^LICENSE\\.md$&#39;</span> to <span style="color:#e6db74">&#39;.Rbuildignore&#39;</span>
</code></pre></div><p>Now when we re-run <code>devtools::check()</code> it passes with flying colors!</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#ae81ff">0</span> errors ✓ <span style="color:#f92672">|</span> <span style="color:#ae81ff">0</span> warnings ✓ <span style="color:#f92672">|</span> <span style="color:#ae81ff">0</span> notes ✓
</code></pre></div><h2 id="data">Data</h2>
<p>We created a test dataset in the previous post to test the <code>separate_uk_cols()</code> function, which we will include in the package. The great thing about structuring your projects as a package is that everything has a home :)</p>
<p>We can include the commands used to create the <code>j3s</code> data in the <code>data-raw/</code> folder using the <code>usethis::use_data_raw()</code> function:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">usethis<span style="color:#f92672">::</span><span style="color:#a6e22e">use_data_raw</span>(name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;j3s&#34;</span>)
✓ Creating <span style="color:#e6db74">&#39;data-raw/&#39;</span>
✓ Adding <span style="color:#e6db74">&#39;^data-raw$&#39;</span> to <span style="color:#e6db74">&#39;.Rbuildignore&#39;</span>
✓ Writing <span style="color:#e6db74">&#39;data-raw/j3s.R&#39;</span>
● Modify <span style="color:#e6db74">&#39;data-raw/j3s.R&#39;</span>
● Finish the data preparation script in <span style="color:#e6db74">&#39;data-raw/j3s.R&#39;</span>
● Use `usethis::use_data()` to add prepared data to package
</code></pre></div><p>We will add the code to <code>data-raw/j3s.R</code> (I&rsquo;ve left the boilerplate portions in this file):</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#75715e">## code to prepare `j3s` dataset goes here</span>

j3s <span style="color:#f92672">&lt;-</span> tibble<span style="color:#f92672">::</span><span style="color:#a6e22e">tribble</span>(
        <span style="color:#f92672">~</span>value,                       <span style="color:#f92672">~</span>name,
           <span style="color:#ae81ff">29L</span>,                      <span style="color:#e6db74">&#34;John&#34;</span>,
           <span style="color:#ae81ff">91L</span>,               <span style="color:#e6db74">&#34;John, Jacob&#34;</span>,
           <span style="color:#ae81ff">39L</span>, <span style="color:#e6db74">&#34;John, Jacob, Jingleheimer&#34;</span>,
           <span style="color:#ae81ff">28L</span>,     <span style="color:#e6db74">&#34;Jingleheimer, Schmidt&#34;</span>,
           <span style="color:#ae81ff">12L</span>,              <span style="color:#e6db74">&#34;JJJ, Schmidt&#34;</span>)

usethis<span style="color:#f92672">::</span><span style="color:#a6e22e">use_data</span>(j3s, overwrite <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>)
</code></pre></div><p>After saving and running this code, we can see that the <code>usethis::use_data(j3s, overwrite = TRUE)</code> function adds the <code>j3s.rda</code> to the <code>data/</code> folder only once.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">usethis<span style="color:#f92672">::</span><span style="color:#a6e22e">use_data</span>(j3s, j3s)
Warning<span style="color:#f92672">:</span> Saving duplicates only once<span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;j3s&#39;</span>
✓ Saving <span style="color:#e6db74">&#39;j3s&#39;</span> to <span style="color:#e6db74">&#39;data/j3s.rda&#39;</span>
● Document your <span style="color:#a6e22e">data </span>(see <span style="color:#e6db74">&#39;https://r-pkgs.org/data.html&#39;</span>)
</code></pre></div><p>Lets take a look at the <code>diyrrr</code> package contents:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">diyrrr/
    ├── DESCRIPTION
    ├── LICENSE
    ├── LICENSE.md
    ├── NAMESPACE
    ├── R
    │   └── separate_uk_cols.R
    ├── data
    │   └── j3s.rda
    ├── data-raw
    │   └── j3s.R
    ├── diyrrr.Rproj
    └── man
        └── separate_uk_cols.Rd
</code></pre></div><p>Let&rsquo;s build and install this package so see if it works!</p>
<h2 id="build-tools">Build tools</h2>
<p>We need to configure our build tools a bit before building the <code>diyrrr</code> package. Navigate to the <strong>Build</strong> pane and click on <em>More</em> &gt; <em>Configure Build Tools&hellip;</em></p>
<!-- raw HTML omitted -->
<p><img src="https://raw.githubusercontent.com/mjfrigaard/tidyverse-tips/master/content/posts/2021-04-08-creating-an-r-package/images/diyrrr-pkg-04.jpg" alt=""></p>
<p>Under <em>Project Options</em> click on <em>Generate documentation with Roxygen</em>,</p>
<!-- raw HTML omitted -->
<p><img src="https://raw.githubusercontent.com/mjfrigaard/tidyverse-tips/master/content/posts/2021-04-08-creating-an-r-package/images/diyrrr-pkg-05.jpg" alt=""></p>
<p>then click the following options:</p>
<!-- raw HTML omitted -->
<p><img src="https://raw.githubusercontent.com/mjfrigaard/tidyverse-tips/master/content/posts/2021-04-08-creating-an-r-package/images/diyrrr-pkg-06.jpg" alt=""></p>
<p>Click <em>Ok</em> and <em>Ok</em>, the click on <em>Install and Restart</em> in the <strong>Build</strong> pane. You should see the following:</p>
<!-- raw HTML omitted -->
<p><img src="https://raw.githubusercontent.com/mjfrigaard/tidyverse-tips/master/content/posts/2021-04-08-creating-an-r-package/images/diyrrr-pkg-07.jpg" alt=""></p>
<p>And the <code>diyrrr</code> package should be loaded in the <strong>Console</strong> pane.</p>
<!-- raw HTML omitted -->
<p><img src="https://raw.githubusercontent.com/mjfrigaard/tidyverse-tips/master/content/posts/2021-04-08-creating-an-r-package/images/diyrrr-pkg-08.jpg" alt=""></p>
<p>We can see the package has been loaded and the data and functions are available!</p>
<h2 id="add-commmit-and-push-to-git">Add, commmit and push to Git</h2>
<p>Now that we have our package working, we will add and commit the files to Git (and push to Github if you&rsquo;re using it).</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ git add -A
$ git commit -m <span style="color:#e6db74">&#34;script and data added&#34;</span>
<span style="color:#f92672">[</span>master 097fb93<span style="color:#f92672">]</span> script and data added
 <span style="color:#ae81ff">12</span> files changed, <span style="color:#ae81ff">92</span> insertions<span style="color:#f92672">(</span>+<span style="color:#f92672">)</span>, <span style="color:#ae81ff">32</span> deletions<span style="color:#f92672">(</span>-<span style="color:#f92672">)</span>
 create mode <span style="color:#ae81ff">100644</span> LICENSE
 create mode <span style="color:#ae81ff">100644</span> LICENSE.md
 delete mode <span style="color:#ae81ff">100644</span> R/hello.R
 create mode <span style="color:#ae81ff">100644</span> R/separate_uk_cols.R
 create mode <span style="color:#ae81ff">100644</span> data-raw/j3s.R
 create mode <span style="color:#ae81ff">100644</span> data/j3s.rda
 delete mode <span style="color:#ae81ff">100644</span> man/hello.Rd
 create mode <span style="color:#ae81ff">100644</span> man/separate_uk_cols.Rd
$ git remote add origin git@github.com:mjfrigaard/diyrrr.git
$ git branch -M main
$ git push -u origin main
Enumerating objects: 27, <span style="color:#66d9ef">done</span>.
Counting objects: 100% <span style="color:#f92672">(</span>27/27<span style="color:#f92672">)</span>, <span style="color:#66d9ef">done</span>.
Delta compression using up to <span style="color:#ae81ff">4</span> threads
Compressing objects: 100% <span style="color:#f92672">(</span>18/18<span style="color:#f92672">)</span>, <span style="color:#66d9ef">done</span>.
Writing objects: 100% <span style="color:#f92672">(</span>27/27<span style="color:#f92672">)</span>, 4.15 KiB | 81.00 KiB/s, <span style="color:#66d9ef">done</span>.
Total <span style="color:#ae81ff">27</span> <span style="color:#f92672">(</span>delta 2<span style="color:#f92672">)</span>, reused <span style="color:#ae81ff">0</span> <span style="color:#f92672">(</span>delta 0<span style="color:#f92672">)</span>
remote: Resolving deltas: 100% <span style="color:#f92672">(</span>2/2<span style="color:#f92672">)</span>, <span style="color:#66d9ef">done</span>.
To github.com:mjfrigaard/diyrrr.git
 * <span style="color:#f92672">[</span>new branch<span style="color:#f92672">]</span>      main -&gt; main
Branch <span style="color:#e6db74">&#39;main&#39;</span> set up to track remote branch <span style="color:#e6db74">&#39;main&#39;</span> from <span style="color:#e6db74">&#39;origin&#39;</span>.

</code></pre></div><p>Now <code>diyrrr</code> lives on <a href="https://github.com/mjfrigaard/diyrrr">Github</a> :)</p>


<footer>
    <div>
        <h3><a href="https://www.tidyverse.tips/posts">Back to all posts</a></h3>
    </div>
    <hr>
    <p>Go <a href="https://www.tidyverse.tips//index.xml">here</a> for an RSS feed.</p>
</footer>

</html>