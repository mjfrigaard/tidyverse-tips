<!doctype html>
<html lang="en"><head>
    <title>How to create crosstabulations</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="stylesheet" href="../../css/theme.css"/>
    
</head>
<body>
        <div id="content" class="mx-auto"><header class="container mt-sm-5 mt-4 mb-4 mt-xs-1">
    <div class="row">
        <div class="col-sm-4 col-12 text-sm-right text-center pt-sm-4">
            <a href="../../" class="text-decoration-none">
                <img id="home-image" class="rounded-circle"
                    
                        src="../../images/avatar.png"
                    
                />
            </a>
        </div>
        <div class="col-sm-8 col-12 text-sm-left text-center">
            <h2 class="m-0 mb-2 mt-4">
                <a href="../../" class="text-decoration-none">
                    
                        Tidyverse Tips
                    
                </a>
            </h2>
            <p class="text-muted mb-1">
                
                    Martin&#39;s #rstats blog
                
            </p>
            <ul id="nav-links" class="list-inline mb-2">
                
                
                    <li class="list-inline-item">
                        <a class="badge badge-white " href="../../about/" title="About">About</a>
                    </li>
                
                    <li class="list-inline-item">
                        <a class="badge badge-white " href="../../post/" title="Posts">Posts</a>
                    </li>
                
                    <li class="list-inline-item">
                        <a class="badge badge-white " href="../../categories/" title="Categories">Categories</a>
                    </li>
                
            </ul>
            <ul id="nav-social" class="list-inline">
                
                    <li class="list-inline-item mr-3">
                        <a href="http://github.com/mjfrigaard" target="_blank">
                            <i class="fab fa-github fa-1x text-muted"></i>
                        </a>
                    </li>
                
                    <li class="list-inline-item mr-3">
                        <a href="https://www.linkedin.com/in/mjfrigaard/" target="_blank">
                            <i class="fab fa-linkedin-in fa-1x text-muted"></i>
                        </a>
                    </li>
                
                    <li class="list-inline-item mr-3">
                        <a href="https://twitter.com/mjfrigaard" target="_blank">
                            <i class="fab fa-twitter fa-1x text-muted"></i>
                        </a>
                    </li>
                
            </ul>
        </div>
    </div>
    <hr />
</header>
<div class="container">
    <div class="pl-sm-2">
        <div class="mb-3">
            <h3 class="mb-0">How to create crosstabulations</h3>
            
            <small class="text-muted">Published July 3, 2020</small>
        </div>

        <article>
            
<script src="../../rmarkdown-libs/header-attrs/header-attrs.js"></script>
<link href="../../rmarkdown-libs/pagedtable/css/pagedtable.css" rel="stylesheet" />
<script src="../../rmarkdown-libs/pagedtable/js/pagedtable.js"></script>


<div id="general-cross-tabulations" class="section level3">
<h3>General cross-tabulations?</h3>
<p>This post was inspired by two 2015 <a href="https://twitter.com/JennyBryan/status/599379158452416512">tweets</a> from <a href="https://twitter.com/JennyBryan">Jenny Bryan</a>.</p>
<p>Here is the first tweet,</p>
<p><img src="../../post/2020-07-03-how-to-create-crosstabulations_files/jbtwee1.png" style="width:80.0%" /></p>
<p>The original question had some follow-up clarification from Jenny Bryan, which is presented below:</p>
<p><img src="../../post/2020-07-03-how-to-create-crosstabulations_files/jbtwee2.png" style="width:80.0%" /></p>
<p>Cross-tabulations (or <a href="https://en.wikipedia.org/wiki/Contingency_table">contingency tables</a>) are very helpful for counting things, especially if you’re dealing with categorical variables that have multiple responses.</p>
<p>The original tweets resulted in quite a few responses from the #rstats community for creating “general cross-tabulation[s],” all of which are summarized in this <a href="https://gist.github.com/jennybc/04b71bfaaf0f88d9d2eb#file-2015-05-15_cross-tabulation-md">gist</a>.</p>
<p>However, some great new packages have come out in the last five years! This post is an attempt to update and add to the gist with more options for creating crosstabs.</p>
</div>
<div id="what-goes-in-a-crosstabulations" class="section level3">
<h3>What goes in a crosstabulations?</h3>
<p>Crosstabulations (or crosstabs) are summary tables displaying counts of categorical variables. Categorical variables typically have a defined set of known values, and the simplest of these being binary (<code>yes</code>/<code>no</code>, <code>true</code>/<code>false</code>, etc.).</p>
<p>Therefore, the cross-tabulation of two binary variables is sometimes referred to as a <em>2 X 2 contingency table</em>.</p>
</div>
<div id="the-2-x-2-table" class="section level3">
<h3>The 2 x 2 table</h3>
<p>We’ll start by looking at the vaccination for Polio created by Jonas Salk.</p>
<pre class="r"><code>PolioVac2x2</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["-"],"name":[1],"type":["chr"],"align":["left"]},{"label":["Polio"],"name":[2],"type":["int"],"align":["right"]},{"label":["No Polio"],"name":[3],"type":["int"],"align":["right"]},{"label":["Total"],"name":[4],"type":["int"],"align":["right"]}],"data":[{"1":"Salk Vaccine","2":"57","3":"200688","4":"200745"},{"1":"Placebo Vaccine","2":"142","3":"201087","4":"201229"},{"1":"Total","2":"199","3":"401775","4":"401974"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>These data come from the <a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC1622939/pdf/amjphnation00353-0017.pdf">1955 paper by Francis et al</a>. You might be wondering why we’d create a table like this? Well, displaying cross-tabulations allows us to see the results summarized by the experimental conditions.</p>
<p><img src="../../post/2020-07-03-how-to-create-crosstabulations_files/tidy-crosstabs.png" style="width:80.0%" /></p>
<p>In this table,</p>
<ol style="list-style-type: decimal">
<li><p>Two cells support the argument of an effective vaccine (the children getting the <code>Salk Vaccine</code> didn’t develop polio (<code>No Polio</code>), and the children who received the <code>Placebo Vaccine</code> developed <code>Polio</code>),</p></li>
<li><p>Two cells support the argument of an ineffective vaccine (children getting the <code>Placebo Vaccine</code> didn’t develop polio (<code>No Polio</code>), and the children who received the <code>Salk Vaccine</code> developed <code>Polio</code>),</p></li>
</ol>
<p>Cross-tabulations are also used to calculate a lot of dichotomous tests, too (like <a href="https://en.wikipedia.org/wiki/Sensitivity_and_specificity">sensitivity, specificity</a>, <a href="https://en.wikipedia.org/wiki/Likelihood_ratios_in_diagnostic_testing">likelihood ratios</a>, etc).</p>
</div>
<div id="the-gss_cat-data" class="section level3">
<h3>The <code>gss_cat</code> data</h3>
<p>The <code>gss_cat</code> data come from the <a href="https://forcats.tidyverse.org/"><code>forcats</code> package</a>, and it has <em>sample of categorical variables from the General Social survey</em>.</p>
<p>We’ll use the <code>inspectdf::inspect_cat()</code> plot to take a look at the levels in each factor variable.</p>
<pre class="r"><code>library(inspectdf)
gss_cat &lt;- forcats::gss_cat
gss_cat %&gt;% 
  inspectdf::inspect_cat() %&gt;% 
  inspectdf::show_plot(text_labels = TRUE)</code></pre>
<p><img src="../../post/2020-07-03-how-to-create-crosstabulations_files/figure-html/gss_cat-1.png" width="864" /></p>
<p>This graph shows us the <code>gss_cat</code> dataset has six factor variables on mostly irreligious (<code>Not applicable</code>), <code>Married</code>, <code>Independent</code>, <code>White</code>, <code>Protestant</code> people making <code>$25,000</code> or more.</p>
</div>
<div id="create-a-binary-married-variable" class="section level3">
<h3>Create a binary <code>married</code> variable</h3>
<p>Someone told me to always name binary variables the name of the response it represents, that way I would never wonder what the <code>1</code>s and <code>0</code>s mean. For example, a variable named <code>married</code> would be <code>1</code> = “married” and <code>0</code> = “not married”.</p>
<p>Coding responses this way is also handy if you’re summing binary categories. Below we will create a numeric binary variable called <code>married</code>, which will be coded as,</p>
<p><code>"Married"</code> = <code>1</code></p>
<p><code>"Never married"</code>/<code>"Separated"</code>/<code>"Divorced"</code>/<code>"Widowed"</code> = <code>0</code></p>
<p><code>"No answer"</code> = <code>NA</code></p>
<p>We’ll use <code>dplyr::mutate()</code> and <code>dplyr::case_when()</code>:</p>
<pre class="r"><code>gss_cat &lt;- gss_cat %&gt;% 
  dplyr::mutate(married = case_when(
    
    marital == &quot;Married&quot; ~ 1, 
    
    marital == &quot;Never married&quot; ~ 0, 
    marital == &quot;Separated&quot; ~ 0, 
    marital == &quot;Divorced&quot; ~ 0, 
    marital == &quot;Widowed&quot; ~ 0, 
    
    marital == &quot;No answer&quot; ~ NA_real_,
    TRUE ~ NA_real_))</code></pre>
</div>
<div id="crosstabs-with-dplyr-and-tidyr" class="section level3">
<h3>Crosstabs with <code>dplyr</code> and <code>tidyr</code></h3>
<p>How would we know if we create the <code>marital</code> variable right?</p>
<p>Well, we could create a cross-tab of <code>marital</code> and <code>married</code> using <code>dplyr::group_by()</code> and <code>dplyr::summarize()</code>.</p>
<pre class="r"><code>gss_cat %&gt;%
  dplyr::group_by(marital, married) %&gt;%
  dplyr::summarize(married = sum(married == 1),
                  `not married` = sum(married == 0))</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["marital"],"name":[1],"type":["fctr"],"align":["left"]},{"label":["married"],"name":[2],"type":["int"],"align":["right"]},{"label":["not married"],"name":[3],"type":["int"],"align":["right"]}],"data":[{"1":"No answer","2":"NA","3":"NA"},{"1":"Never married","2":"0","3":"1"},{"1":"Separated","2":"0","3":"1"},{"1":"Divorced","2":"0","3":"1"},{"1":"Widowed","2":"0","3":"1"},{"1":"Married","2":"10117","3":"0"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>How can we check our work? Well, before we do that, we will cover the differences between <code>dplyr::group_by()</code> + <code>dplyr::summarize()</code>, <code>dplyr::count()</code>, and the lower level function <code>dplyr::tally()</code>.</p>
<div id="group_by-summarize-count" class="section level4">
<h4><code>group_by</code>, <code>summarize</code> &amp; <code>count</code></h4>
<p><code>dplyr::count()</code> is really the <code>dplyr::group_by()</code> and <code>dplyr::summarize()</code> functions combined. Per the description from the help file,</p>
<p><em>equivalent to <code>df %&gt;% group_by(a, b) %&gt;% summarise(n = n())</code></em></p>
<p>So, the call above used <code>dplyr::group_by()</code> and <code>dplyr::summarize()</code> to collapse the original <code>gss_cat</code> tibble into the available categories in <code>marital</code> and <code>married</code>.</p>
<p>We then we fed the output of <code>dplyr::group_by(marital, married)</code> + <code>dplyr::summarize()</code> to the <code>sum()</code> function, but we had to specify the two conditions (<code>married == 1</code> and <code>not married == 0</code>) in order to get a 2 x 2 table.</p>
<p>If we compare <code>dplyr::group_by()</code> + <code>dplyr::summarize(n = n())</code> with the numbers from <code>dplyr::count()</code> below, we see they are identical.</p>
<pre class="r"><code>gss_cat %&gt;%
  dplyr::count(marital, married)</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["marital"],"name":[1],"type":["fctr"],"align":["left"]},{"label":["married"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["n"],"name":[3],"type":["int"],"align":["right"]}],"data":[{"1":"No answer","2":"NA","3":"17"},{"1":"Never married","2":"0","3":"5416"},{"1":"Separated","2":"0","3":"743"},{"1":"Divorced","2":"0","3":"3383"},{"1":"Widowed","2":"0","3":"1807"},{"1":"Married","2":"1","3":"10117"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<pre class="r"><code>gss_cat %&gt;% 
  dplyr::group_by(marital, married) %&gt;% 
  dplyr::summarise(n = n())</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["marital"],"name":[1],"type":["fctr"],"align":["left"]},{"label":["married"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["n"],"name":[3],"type":["int"],"align":["right"]}],"data":[{"1":"No answer","2":"NA","3":"17"},{"1":"Never married","2":"0","3":"5416"},{"1":"Separated","2":"0","3":"743"},{"1":"Divorced","2":"0","3":"3383"},{"1":"Widowed","2":"0","3":"1807"},{"1":"Married","2":"1","3":"10117"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>All the categories from <code>marital</code> and <code>married</code> are accounted for.</p>
</div>
<div id="tally" class="section level4">
<h4><code>tally</code></h4>
<p>The <code>dplyr::tally()</code> function doesn’t do any grouping before it counts up the categorical levels, so if we try to use it like <code>dplyr::count()</code>, we get an error.</p>
<pre class="r"><code>gss_cat %&gt;% 
  dplyr::tally(marital, married)
#&gt;  Error: Problem with `summarise()` input `n`.
#&gt;  x &#39;sum&#39; not meaningful for factors
#&gt;  ℹ Input `n` is `sum(marital, na.rm = TRUE)`.</code></pre>
<p>If we can use <code>dplyr::group_by(marital, married)</code> and then feed it to <code>dplyr::tally()</code>, it works fine.</p>
<pre class="r"><code>gss_cat %&gt;% 
  dplyr::group_by(marital, married) %&gt;% 
  dplyr::tally()</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["marital"],"name":[1],"type":["fctr"],"align":["left"]},{"label":["married"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["n"],"name":[3],"type":["int"],"align":["right"]}],"data":[{"1":"No answer","2":"NA","3":"17"},{"1":"Never married","2":"0","3":"5416"},{"1":"Separated","2":"0","3":"743"},{"1":"Divorced","2":"0","3":"3383"},{"1":"Widowed","2":"0","3":"1807"},{"1":"Married","2":"1","3":"10117"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>But none of these functions give us an output that distributes the categorical responses across the columns (unless we provide all levels of one of the grouped variables).</p>
<p>Which, as Jenny points out, would be a <em>horrifying</em> idea if we had a categorical variable that had multiple levels. Consider <code>rincome</code> (16 levels) and <code>denom</code> (30 levels)!</p>
<p>A crosstabulation gives us an idea of where the counts overlap for each response category, but so far we’ve only been able to see all possible combinations of <code>marital</code> and <code>married</code> with a single <code>n</code> column.</p>
</div>
<div id="count-pivot" class="section level4">
<h4><code>count</code> &amp; <code>pivot</code></h4>
<p>We can combine <code>dplyr</code> with <code>tidyr</code> to create quick cross-tabs for categorical variables. First we’ll use <code>dplyr::count()</code> to get the counts for each response, then we can change the structure of the output from the collapsed tibble with <code>tidyr::pivot_wider()</code>.</p>
<p>For example, we can count <code>married</code> and <code>marital</code>, then pivot <code>married</code> responses across the columns.</p>
<pre class="r"><code>gss_cat %&gt;%
  dplyr::count(married, marital) %&gt;% 
  tidyr::pivot_wider(names_from = married, 
                     values_from = n)</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["marital"],"name":[1],"type":["fctr"],"align":["left"]},{"label":["0"],"name":[2],"type":["int"],"align":["right"]},{"label":["1"],"name":[3],"type":["int"],"align":["right"]},{"label":["NA"],"name":[4],"type":["int"],"align":["right"]}],"data":[{"1":"Never married","2":"5416","3":"NA","4":"NA"},{"1":"Separated","2":"743","3":"NA","4":"NA"},{"1":"Divorced","2":"3383","3":"NA","4":"NA"},{"1":"Widowed","2":"1807","3":"NA","4":"NA"},{"1":"Married","2":"NA","3":"10117","4":"NA"},{"1":"No answer","2":"NA","3":"NA","4":"17"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>Or we can pivot the <code>marital</code> categories across the columns.</p>
<pre class="r"><code>gss_cat %&gt;%
  dplyr::count(married, marital) %&gt;% 
  tidyr::pivot_wider(names_from = marital, 
                     values_from = n)</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["married"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["Never married"],"name":[2],"type":["int"],"align":["right"]},{"label":["Separated"],"name":[3],"type":["int"],"align":["right"]},{"label":["Divorced"],"name":[4],"type":["int"],"align":["right"]},{"label":["Widowed"],"name":[5],"type":["int"],"align":["right"]},{"label":["Married"],"name":[6],"type":["int"],"align":["right"]},{"label":["No answer"],"name":[7],"type":["int"],"align":["right"]}],"data":[{"1":"0","2":"5416","3":"743","4":"3383","5":"1807","6":"NA","7":"NA"},{"1":"1","2":"NA","3":"NA","4":"NA","5":"NA","6":"10117","7":"NA"},{"1":"NA","2":"NA","3":"NA","4":"NA","5":"NA","6":"NA","7":"17"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>In both cases, we can see the each categorical level of <code>married</code> and <code>marital</code> printed to the screen, with the <code>n</code> for each cell.</p>
</div>
</div>
<div id="previous-examples" class="section level3">
<h3>Previous examples</h3>
<p><strong>Note</strong> 1) <code>tidyr::spread()</code> is roughly equivalent to <code>tidyr::pivot_wider()</code>, so these are updated versions of the previous answers below, 2) recall that <code>mtcars</code> is a <code>data.frame</code>, not a <code>tibble</code>, so the printing will look different.</p>
<pre class="r"><code>base::class(mtcars)
# [1] &quot;data.frame&quot;

# group_by, summarize, and spread ---- ---- ----
mtcars %&gt;%
  dplyr::group_by(cyl, vs) %&gt;%
  dplyr::summarize(count = n()) %&gt;%
  tidyr::spread(vs, count)
# `summarise()` regrouping output by &#39;cyl&#39; (override with `.groups` argument)
# # A tibble: 3 x 3
# # Groups:   cyl [3]
#     cyl   `0`   `1`
#   &lt;dbl&gt; &lt;int&gt; &lt;int&gt;
# 1     4     1    10
# 2     6     3     4
# 3     8    14    NA</code></pre>
<p>As you can see from the output above, when <code>dplyr::group_by()</code> and <code>dplyr::summarize()</code> are combined, a message tells us it would be <code>regrouping</code> the output <code>tibble</code> (we can fix this with <code>dplyr::ungroup()</code> or <code>.groups</code>).</p>
<pre class="r"><code># group_by, tally, and spread ---- ---- ----
mtcars %&gt;%
  dplyr::group_by(cyl, vs) %&gt;%
  dplyr::tally() %&gt;%
  tidyr::spread(vs, n)
# # A tibble: 3 x 3
# # Groups:   cyl [3]
#     cyl   `0`   `1`
#   &lt;dbl&gt; &lt;int&gt; &lt;int&gt;
# 1     4     1    10
# 2     6     3     4
# 3     8    14    NA</code></pre>
<p>In the second example, <code>dplyr::group_by(cyl, vs)</code> was combined with <code>dplyr::tally()</code>, and they return a grouped <code>tibble</code> <em>without</em> a message or warning (because it assumes we want the <code>tibble</code> to remain grouped).</p>
<pre class="r"><code># count and spread ---- ---- ----
mtcars %&gt;%
  dplyr::count(cyl, vs) %&gt;%
  tidyr::spread(vs, n) 
#   cyl  0  1
# 1   4  1 10
# 2   6  3  4
# 3   8 14 NA</code></pre>
<p>The final example uses only <code>dplyr::count()</code> and <code>tidyr::spread()</code> and returns a regular <code>data.frame</code>.</p>
</div>
<div id="crosstabyls-with-janitor" class="section level3">
<h3>Cross<code>tabyls</code> with <code>janitor</code></h3>
<p>The <a href="https://garthtarr.github.io/meatR/janitor.html"><code>janitor</code> package</a> has a ton of great tools for data wrangling (see <code>janitor::clean_names()</code>), and this package also creates crosstabs with it’s <code>tabyl()</code> function.</p>
<p>We’ll create a <code>tabyl</code> of marital and race called <code>MarRacTabyl</code> below:</p>
<pre class="r"><code>library(janitor)
MarRacTabyl &lt;- gss_cat %&gt;% 
  janitor::tabyl(marital, race)
class(MarRacTabyl)
#&gt;  [1] &quot;tabyl&quot;      &quot;data.frame&quot;</code></pre>
<p><code>tabyl</code>s are their own class, which allows for beautifully formatted crosstabs that print nicely to the console or Rmarkdown file.</p>
<pre class="r"><code>MarRacTabyl
#&gt;         marital Other Black White Not applicable
#&gt;       No answer     2     2    13              0
#&gt;   Never married   633  1305  3478              0
#&gt;       Separated   110   196   437              0
#&gt;        Divorced   212   495  2676              0
#&gt;         Widowed    70   262  1475              0
#&gt;         Married   932   869  8316              0</code></pre>
<p>The output of a <code>tabyl</code> is nearly identical to the output from <code>dplyr::count()</code> + <code>tidyr::pivot_wider()</code>, but <code>janitor</code> makes it easy to add totals, percentages, and formatting using the <code>adorn_()</code> functions:</p>
<div id="add-a-total-column" class="section level4">
<h4>Add a total column</h4>
<pre class="r"><code># add total column ----  ----  ----  ---- 
MarRacTabyl %&gt;% 
  janitor::adorn_totals(where = &quot;col&quot;)

       marital Other Black White Not applicable Total
     No answer     2     2    13              0    17
 Never married   633  1305  3478              0  5416
     Separated   110   196   437              0   743
      Divorced   212   495  2676              0  3383
       Widowed    70   262  1475              0  1807
       Married   932   869  8316              0 10117</code></pre>
</div>
<div id="add-a-total-row" class="section level4">
<h4>Add a total row</h4>
<pre class="r"><code># add total row, drop missing ----  ----  ----  ---- 
MarRacTabyl &lt;- gss_cat %&gt;% 
  janitor::tabyl(marital, race, 
                 show_missing_levels = FALSE)
MarRacTabyl %&gt;% 
  janitor::adorn_totals(where = &quot;row&quot;)

       marital Other Black White
     No answer     2     2    13
 Never married   633  1305  3478
     Separated   110   196   437
      Divorced   212   495  2676
       Widowed    70   262  1475
       Married   932   869  8316
         Total  1959  3129 16395</code></pre>
</div>
<div id="add-percentages-and-round" class="section level4">
<h4>Add percentages (and round)</h4>
<pre class="r"><code># add percentages and format ----  ----  ----  ---- 
MarRacTabyl %&gt;% 
  janitor::adorn_percentages(&quot;row&quot;) %&gt;%
  janitor::adorn_pct_formatting(digits = 2) 

       marital  Other  Black  White
     No answer 11.76% 11.76% 76.47%
 Never married 11.69% 24.10% 64.22%
     Separated 14.80% 26.38% 58.82%
      Divorced  6.27% 14.63% 79.10%
       Widowed  3.87% 14.50% 81.63%
       Married  9.21%  8.59% 82.20%</code></pre>
</div>
<div id="add-ns-and-percentages" class="section level4">
<h4>Add ns and percentages</h4>
<pre class="r"><code># add ns with percentages ----  ----  ----  ----
MarRacTabyl %&gt;%
  janitor::adorn_percentages(&quot;row&quot;) %&gt;%
  janitor::adorn_pct_formatting(digits = 2) %&gt;%
  janitor::adorn_ns()
  
       marital        Other         Black         White
     No answer 11.76%   (2) 11.76%    (2) 76.47%   (13)
 Never married 11.69% (633) 24.10% (1305) 64.22% (3478)
     Separated 14.80% (110) 26.38%  (196) 58.82%  (437)
      Divorced  6.27% (212) 14.63%  (495) 79.10% (2676)
       Widowed  3.87%  (70) 14.50%  (262) 81.63% (1475)
       Married  9.21% (932)  8.59%  (869) 82.20% (8316)</code></pre>
<p>It’s important to note that the order of the adorn functions matters. For example, calling <code>janitor::adorn_totals(where = "col")</code> at the end of this pipeline will throw an error,</p>
<pre class="r"><code>MarRacTabyl %&gt;% 
  janitor::adorn_percentages(&quot;row&quot;) %&gt;%
  janitor::adorn_pct_formatting(digits = 2) %&gt;%
  janitor::adorn_ns() %&gt;% 
  janitor::adorn_totals(where = &quot;col&quot;) 
#&gt; Error in janitor::adorn_totals(., where = &quot;col&quot;) : 
#&gt;  at least one targeted column must be of class numeric.  Control target 
#&gt;  variables with the ... argument. adorn_totals should be called before 
#&gt;  other adorn_ functions.</code></pre>
<p>But, if we add a total column <em>before</em> the percentages, everything works fine.</p>
<pre class="r"><code>MarRacTabyl %&gt;% 
  janitor::adorn_totals(where = &quot;col&quot;) %&gt;% 
  janitor::adorn_percentages(&quot;row&quot;) %&gt;%
  janitor::adorn_pct_formatting(digits = 2) %&gt;%
  janitor::adorn_ns() 

       marital        Other         Black         White Not applicable           Total
     No answer 11.76%   (2) 11.76%    (2) 76.47%   (13)      0.00% (0) 100.00%    (17)
 Never married 11.69% (633) 24.10% (1305) 64.22% (3478)      0.00% (0) 100.00%  (5416)
     Separated 14.80% (110) 26.38%  (196) 58.82%  (437)      0.00% (0) 100.00%   (743)
      Divorced  6.27% (212) 14.63%  (495) 79.10% (2676)      0.00% (0) 100.00%  (3383)
       Widowed  3.87%  (70) 14.50%  (262) 81.63% (1475)      0.00% (0) 100.00%  (1807)
       Married  9.21% (932)  8.59%  (869) 82.20% (8316)      0.00% (0) 100.00% (10117)</code></pre>
<p>These also print well with <code>rmarkdown::paged_table()</code> and <code>knitr::kable()</code></p>
</div>
<div id="tabyl-paged_table" class="section level4">
<h4><code>tabyl</code> + <code>paged_table()</code></h4>
<pre class="r"><code>rmarkdown::paged_table(
  MarRacTabyl %&gt;% 
  janitor::adorn_totals(where = &quot;col&quot;) %&gt;% 
  janitor::adorn_percentages(&quot;row&quot;) %&gt;%
  janitor::adorn_pct_formatting(digits = 2) %&gt;%
  janitor::adorn_ns()
)</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["marital"],"name":[1],"type":["fctr"],"align":["left"]},{"label":["Other"],"name":[2],"type":["chr"],"align":["left"]},{"label":["Black"],"name":[3],"type":["chr"],"align":["left"]},{"label":["White"],"name":[4],"type":["chr"],"align":["left"]},{"label":["Total"],"name":[5],"type":["chr"],"align":["left"]}],"data":[{"1":"No answer","2":"11.76%   (2)","3":"11.76%    (2)","4":"76.47%   (13)","5":"100.00%    (17)","_rn_":"1"},{"1":"Never married","2":"11.69% (633)","3":"24.10% (1305)","4":"64.22% (3478)","5":"100.00%  (5416)","_rn_":"2"},{"1":"Separated","2":"14.80% (110)","3":"26.38%  (196)","4":"58.82%  (437)","5":"100.00%   (743)","_rn_":"3"},{"1":"Divorced","2":"6.27% (212)","3":"14.63%  (495)","4":"79.10% (2676)","5":"100.00%  (3383)","_rn_":"4"},{"1":"Widowed","2":"3.87%  (70)","3":"14.50%  (262)","4":"81.63% (1475)","5":"100.00%  (1807)","_rn_":"5"},{"1":"Married","2":"9.21% (932)","3":"8.59%  (869)","4":"82.20% (8316)","5":"100.00% (10117)","_rn_":"6"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
<div id="tabyl-kable" class="section level4">
<h4><code>tabyl</code> + <code>kable()</code></h4>
<pre class="r"><code>knitr::kable(
  MarRacTabyl %&gt;% 
  janitor::adorn_totals(where = &quot;col&quot;) %&gt;% 
  janitor::adorn_percentages(&quot;row&quot;) %&gt;%
  janitor::adorn_pct_formatting(digits = 2) %&gt;%
  janitor::adorn_ns()
)</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">marital</th>
<th align="left">Other</th>
<th align="left">Black</th>
<th align="left">White</th>
<th align="left">Total</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">No answer</td>
<td align="left">11.76% (2)</td>
<td align="left">11.76% (2)</td>
<td align="left">76.47% (13)</td>
<td align="left">100.00% (17)</td>
</tr>
<tr class="even">
<td align="left">Never married</td>
<td align="left">11.69% (633)</td>
<td align="left">24.10% (1305)</td>
<td align="left">64.22% (3478)</td>
<td align="left">100.00% (5416)</td>
</tr>
<tr class="odd">
<td align="left">Separated</td>
<td align="left">14.80% (110)</td>
<td align="left">26.38% (196)</td>
<td align="left">58.82% (437)</td>
<td align="left">100.00% (743)</td>
</tr>
<tr class="even">
<td align="left">Divorced</td>
<td align="left">6.27% (212)</td>
<td align="left">14.63% (495)</td>
<td align="left">79.10% (2676)</td>
<td align="left">100.00% (3383)</td>
</tr>
<tr class="odd">
<td align="left">Widowed</td>
<td align="left">3.87% (70)</td>
<td align="left">14.50% (262)</td>
<td align="left">81.63% (1475)</td>
<td align="left">100.00% (1807)</td>
</tr>
<tr class="even">
<td align="left">Married</td>
<td align="left">9.21% (932)</td>
<td align="left">8.59% (869)</td>
<td align="left">82.20% (8316)</td>
<td align="left">100.00% (10117)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="crosstabs-with-tidytidbits" class="section level3">
<h3>Crosstabs with <code>tidytidbits</code></h3>
<p>The last example I will mention is from the <a href="https://cran.r-project.org/web/packages/tidytidbits/tidytidbits.pdf"><code>tidytidbits</code></a> package. The <code>cross_tabulate()</code> produces a nicely printed <code>table</code> output.</p>
<pre class="r"><code>library(tidytidbits)
MarRacCross_Tab &lt;- gss_cat %&gt;% 
  tidytidbits::cross_tabulate(marital, race)
MarRacCross_Tab
#&gt;                 race
#&gt;  marital         Other Black White Not applicable
#&gt;    No answer         2     2    13              0
#&gt;    Never married   633  1305  3478              0
#&gt;    Separated       110   196   437              0
#&gt;    Divorced        212   495  2676              0
#&gt;    Widowed          70   262  1475              0
#&gt;    Married         932   869  8316              0</code></pre>
<pre class="r"><code>utils::str(MarRacCross_Tab)
#&gt;   &#39;table&#39; int [1:6, 1:4] 2 633 110 212 70 932 2 1305 196 495 ...
#&gt;   - attr(*, &quot;dimnames&quot;)=List of 2
#&gt;    ..$ marital: chr [1:6] &quot;No answer&quot; &quot;Never married&quot; &quot;Separated&quot; &quot;Divorced&quot; ...
#&gt;    ..$ race   : chr [1:4] &quot;Other&quot; &quot;Black&quot; &quot;White&quot; &quot;Not applicable&quot;</code></pre>
<p>But we lose a lot of functionality going from a <code>data.frame</code> or <code>tibble</code> to a <code>table</code>.</p>
<p>The other options from the gist are provided below for posterity:</p>
<pre class="r"><code>#  use melt and dcast on named columns (no pipe)  ---- ---- ---- ----
library(reshape2)     ## dcast(), melt()
library(data.table)
# not this puts a 0, not an NA
reshape2::dcast(reshape2::melt(mtcars[, c(&quot;cyl&quot;, &quot;vs&quot;)], id = &quot;cyl&quot;), cyl ~ value)
  #   cyl  0  1
  # 1   4  1 10
  # 2   6  3  4
  # 3   8 14  0

# combine dplyr and reshape2 with pipes  ---- ---- ---- ----
# @daroczig 
mtcars %&gt;%
  dplyr::group_by(cyl, vs) %&gt;%
  dplyr::summarize(n()) %&gt;%
  reshape2::dcast(cyl ~ vs)
  # `summarise()` regrouping output by &#39;cyl&#39; (override with `.groups` argument)
  # Using n() as value column: use value.var to override.
  #   cyl  0  1
  # 1   4  1 10
  # 2   6  3  4
  # 3   8 14 NA

# obligatory data.table option 1 (no pipe)  ---- ---- ---- ----
# @daroczig 
mtcarsDT &lt;- mtcars %&gt;% data.table()
dcast(mtcarsDT[, .N, by = list(cyl, vs)], cyl ~ vs)
  # Using &#39;N&#39; as value column. Use &#39;value.var&#39; to override
  #    cyl  0  1
  # 1:   4  1 10
  # 2:   6  3  4
  # 3:   8 14 NA

# obligatory data.table option 2 (pipe)  ---- ---- ---- ----
# @MattDowle
mtcarsDT[, .N, .(cyl, vs)] %&gt;% dcast(cyl ~ vs)
# Using &#39;N&#39; as value column. Use &#39;value.var&#39; to override
  #    cyl  0  1
  # 1:   4  1 10
  # 2:   6  3  4
  # 3:   8 14 NA</code></pre>
</div>
<div id="other-reources-for-crosstabs" class="section level2">
<h2>Other reources for crosstabs</h2>
<p>Check out these other sources for crosstabs:</p>
<ol style="list-style-type: decimal">
<li><p><a href="http://analyticswithr.com/contingencytables.html">Contingency Tables - Analytics with R</a></p></li>
<li><p><a href="https://stackoverflow.com/questions/54377189/tidyverse-cross-tables-of-one-variable-with-all-other-variables-in-data-frame">SO: Cross tables of one variable with all other variables in data.frame</a></p></li>
<li><p><a href="https://cran.r-project.org/web/packages/janitor/vignettes/tabyls.html">Tabyl vignette</a>.</p></li>
<li><p><a href="https://tidyr.tidyverse.org/articles/pivot.html">Pivoting</a></p></li>
<li><p><a href="https://dplyr.tidyverse.org/reference/group_by.html">Group by</a> and <a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a> from <code>dplyr</code></p></li>
</ol>
</div>

        </article>
    </div>

            </div>
        </div><footer class="text-center pb-1">
    <small class="text-muted">
        
            &copy; Copyright Year 2020, Martin Frigaard
        
        <br>
        Powered by <a href="https://gohugo.io/" target="_blank">Hugo</a>
        and <a href="https://github.com/austingebauer/devise" target="_blank">Devise</a>
    </small>
</footer>
</body>
</html>
